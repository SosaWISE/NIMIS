<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name = "description" content = "Online tool to create code for polyline and polygon to Google Maps v3 (version 3)"/>
<title>Tool for Google Maps v3 (version 3)</title>

<head>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name = "description" content = "Online tool to draw markers, polylines, polygons, polygons with hole, circle for Google Maps API. Get coordinates. Write KML file. Write JavaScript code."/>
<title>My Google Maps tool</title>

<title>SS Client Tracker</title>
<link rel="stylesheet" href="css/styles.css">

<style type="text/css">


</style>

<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false" ></script>

<script src="PolylineEncoder.js"></script>
<script type="text/javascript">
  var map;
  var geocoder;
  var centerChangedLast;
  var reverseGeocodedLast;
  var currentReverseGeocodeResponse;





  function initialize() {
    var latlng = new google.maps.LatLng(-111.5468,40.2031);
    var myOptions = {
      zoom: 7,
      center: latlng,
      mapTypeId: google.maps.MapTypeId.ROADMAP
    };
    map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
    geocoder = new google.maps.Geocoder();


    setupEvents();
    centerChanged();
  }

  function setupEvents() {
    reverseGeocodedLast = new Date();
    centerChangedLast = new Date();

    setInterval(function() {
      if((new Date()).getSeconds() - centerChangedLast.getSeconds() > 1) {
        if(reverseGeocodedLast.getTime() < centerChangedLast.getTime())
          reverseGeocode();
      }
    }, 1000);

    google.maps.event.addListener(map, 'zoom_changed', function() {
      document.getElementById("zoom_level").innerHTML = map.getZoom();
    });

    google.maps.event.addListener(map, 'center_changed', centerChanged);

    google.maps.event.addDomListener(document.getElementById('crosshair'),'dblclick', function() {
       map.setZoom(map.getZoom() + 1);
    });

  }

  function getCenterLatLngText() {
    return '(' + map.getCenter().lat() +', '+ map.getCenter().lng() +')';
  }

  function centerChanged() {
    centerChangedLast = new Date();
    var latlng = getCenterLatLngText();
    document.getElementById('latlng').innerHTML = latlng;
    document.getElementById('formatedAddress').innerHTML = '';
    currentReverseGeocodeResponse = null;
  }

  function reverseGeocode() {
    reverseGeocodedLast = new Date();
    geocoder.geocode({latLng:map.getCenter()},reverseGeocodeResult);
  }

  function reverseGeocodeResult(results, status) {
    currentReverseGeocodeResponse = results;
    if(status == 'OK') {
      if(results.length == 0) {
        document.getElementById('formatedAddress').innerHTML = 'None';
      } else {
        document.getElementById('formatedAddress').innerHTML = results[0].formatted_address;
      }
    } else {
      document.getElementById('formatedAddress').innerHTML = 'Error';
    }
  }


  function geocode() {
    var address = document.getElementById("address").value;
    geocoder.geocode({
      'address': address,
      'partialmatch': true}, geocodeResult);
  }

  function geocodeResult(results, status) {
    if (status == 'OK' && results.length > 0) {
      map.fitBounds(results[0].geometry.viewport);
    } else {
      alert("Geocode was not successful for the following reason: " + status);
    }
  }

  function addMarkerAtCenter() {
    var marker = new google.maps.Marker({
        position: map.getCenter(),
        map: map
    });

    var text = 'Lat/Lng: ' + getCenterLatLngText();
    if(currentReverseGeocodeResponse) {
      var addr = '';
      if(currentReverseGeocodeResponse.size == 0) {
        addr = 'None';
      } else {
        addr = currentReverseGeocodeResponse[0].formatted_address;
      }
      text = text + '<br>' + 'address: <br>' + addr;
    }

    var infowindow = new google.maps.InfoWindow({ content: text });

    google.maps.event.addListener(marker, 'click', function() {
	    debugger;
      infowindow.open(map,marker);
    });
  }

</script>


<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script type="text/javascript">
//<![CDATA[

// This application is provided by Kjell Scharning
//  Licensed under the Apache License, Version 2.0;
//  http://www.apache.org/licenses/LICENSE-2.0
//  OpenStreetMap (OSM): http://www.openstreetmap.org/
//  OSM licence, Creative Commons: http://creativecommons.org/licenses/by-sa/2.0/legalcode

function gob(e)
{
	if(typeof(e)=='object')return(e);

	if(document.getElementById)return(document.getElementById(e));

	return(eval(e));
}
var map;
var polyShape;
var markerShape;
//var oldDirMarkers = [];
//var tmpPolyLine;
var drawnShapes = [];
var holeShapes = [];
var startMarker;
var nemarker;
var tinyMarker;
var markers = [];
var midmarkers = [];
//var markerlistener1;
//var markerlistener2;
var rectangle;
var circle;
var southWest;
var northEast;
var centerPoint;
var radiusPoint;
var calc;
var startpoint;
var adder = 0;
var dirpointstart = null;
//var dirpointend = 0;
var dirline;
var waypts = [];
//var waypots = [];
var polyPoints = [];
var pointsArray = [];
var markersArray = [];
var addresssArray = [];
var pointsArrayKml = [];
var markersArrayKml = [];
var toolID = 1;
var codeID = 1;
var shapeId = 0;
var step = 0;
var plmcur = 0;
var lcur = 0;
var pcur = 0;
//var rcur = 0;
var ccur = 0;
var mcur = 0;
var outerPoints = [];
var holePolyArray = [];
var outerShape;
var anotherhole = false;
//var it;
var outerArray = [];
var innerArray = [];
var innerArrays = [];
var outerArrayKml = [];
var innerArrayKml = [];
var innerArraysKml = [];
var placemarks = [];
//var mylistener;
var editing = false;
var notext = false;
var textsignal = 0;
var kmlcode = ""; // Used as signal for have been logged
var javacode = ""; // Used as signal for have been logged
var polylineDecColorCur = "255,0,0";
var polygonDecColorCur = "255,0,0";
var docuname = "My document";
var docudesc = "Content";
var polylinestyles = [];
var polygonstyles = [];
//var rectanglestyles = [];
var circlestyles = [];
var markerstyles = [];
var geocoder; // = new google.maps.Geocoder();
//var startLocation;
var endLocation;
//var dircount;
var dircountstart;
var firstdirclick = 0;
var dirmarknum = 1;
var directionsDisplay;
var directionsService = new google.maps.DirectionsService();
var directionsYes = 0;
var destinations = [];
var removedirectionleg = 0;
//var currentDirections = null;
//var oldpoint = null;
var prevpoint;
var prevnumber;
var copyrightNode;
var infowindow = new google.maps.InfoWindow();//({size: new google.maps.Size(150,50)});
var tmpPolyLine = new google.maps.Polyline({
    strokeColor: "#00FF00",
    strokeOpacity: 0.8,
    strokeWeight: 2
});
var tinyIcon = new google.maps.MarkerImage(
    'icons/marker_20_red.png',
    new google.maps.Size(12,20),
    new google.maps.Point(0,0),
    new google.maps.Point(6,16)
);
/*var tinyShadow = new google.maps.MarkerImage(
    'icons/marker_20_shadow.png',
    new google.maps.Size(22,20),
    new google.maps.Point(6,20),
    new google.maps.Point(5,1)
);*/
var imageNormal = new google.maps.MarkerImage(
	"images/square.png",
	new google.maps.Size(11, 11),
	new google.maps.Point(0, 0),
	new google.maps.Point(6, 6)
);
var imageHover = new google.maps.MarkerImage(
	"images/square_over.png",
	new google.maps.Size(11, 11),
	new google.maps.Point(0, 0),
	new google.maps.Point(6, 6)
);
var imageNormalMidpoint = new google.maps.MarkerImage(
	"images/square_transparent.png",
	new google.maps.Size(11, 11),
	new google.maps.Point(0, 0),
	new google.maps.Point(6, 6)
);
/*var imageHoverMidpoint = new google.maps.MarkerImage(
	"square_transparent_over.png",
	new google.maps.Size(11, 11),
	new google.maps.Point(0, 0),
	new google.maps.Point(6, 6)
);*/
function polystyle() {
    this.name = "Lump";
    this.kmlcolor = "CD0000FF";
    this.kmlfill = "9AFF0000";
    this.color = "#FF0000";
    this.fill = "#0000FF";
    this.width = 2;
    this.lineopac = 0.8;
    this.fillopac = 0.6;
}
function linestyle() {
    this.name = "Path";
    this.kmlcolor = "FF0000FF";
    this.color = "#FF0000";
    this.width = 3;
    this.lineopac = 1;
}
function circstyle() {
    this.name = "Circ";
    this.color = "#FF0000";
    this.fill = "#0000FF";
    this.width = 2;
    this.lineopac = 0.8;
    this.fillopac = 0.6;
}
function markerstyleobject() {
    this.name = "markerstyle";
    this.icon = "http://maps.google.com/intl/en_us/mapfiles/ms/micons/red-dot.png";
}
function placemarkobject() {
    this.name = "NAME";
    this.desc = "YES";
    this.style = "Path";
    this.stylecur = 0;
    this.tess = 1;
    this.alt = "clampToGround";
    this.plmtext = ""; // KLM text from <Placemark> to </Placemark>
    this.jstext = "";
    this.jscode = [];
    this.kmlcode = []; // coordinatepairs lng lat
    this.kmlholecode = []; // coordinatepairs lng lat
    this.poly = "pl";
    this.shape = null;
    this.point = null;
    this.toolID = 1;
    this.hole = 0;
    this.ID = 0;
}
function createplacemarkobject() {
    var thisplacemark = new placemarkobject();
    placemarks.push(thisplacemark);
}
function createpolygonstyleobject() {
    var polygonstyle = new polystyle();
    polygonstyles.push(polygonstyle);
}
function createlinestyleobject() {
    var polylinestyle = new linestyle();
    polylinestyles.push(polylinestyle);
}
function createcirclestyleobject() {
    var cirstyle = new circstyle();
    circlestyles.push(cirstyle);
}
function createmarkerstyleobject() {
    var thisstyle = new markerstyleobject();
    markerstyles.push(thisstyle);
}
function preparePolyline(){
    var polyOptions = {
        path: polyPoints,
        strokeColor: polylinestyles[lcur].color,
        strokeOpacity: polylinestyles[lcur].lineopac,
        strokeWeight: polylinestyles[lcur].width};
    polyShape = new google.maps.Polyline(polyOptions);
    polyShape.setMap(map);
    /*var tmpPolyOptions = {
    	strokeColor: polylinestyles[lcur].color,
    	strokeOpacity: polylinestyles[lcur].lineopac,
    	strokeWeight: polylinestyles[lcur].width
    };
    tmpPolyLine = new google.maps.Polyline(tmpPolyOptions);
    tmpPolyLine.setMap(map);*/
}

function preparePolygon(){
    var polyOptions = {
        path: polyPoints,
        strokeColor: polygonstyles[pcur].color,
        strokeOpacity: polygonstyles[pcur].lineopac,
        strokeWeight: polygonstyles[pcur].width,
        fillColor: polygonstyles[pcur].fill,
        fillOpacity: polygonstyles[pcur].fillopac};
    polyShape = new google.maps.Polygon(polyOptions);
    polyShape.setMap(map);
}
function activateRectangle() {
    rectangle = new google.maps.Rectangle({
        map: map,
        strokeColor: polygonstyles[pcur].color,
        strokeOpacity: polygonstyles[pcur].lineopac,
        strokeWeight: polygonstyles[pcur].width,
        fillColor: polygonstyles[pcur].fill,
        fillOpacity: polygonstyles[pcur].fillopac
    });
}
function activateCircle() {
    circle = new google.maps.Circle({
        map: map,
        fillColor: circlestyles[ccur].fill,
        fillOpacity: circlestyles[ccur].fillopac,
        strokeColor: circlestyles[ccur].color,
        strokeOpacity: circlestyles[ccur].lineopac,
        strokeWeight: circlestyles[ccur].width
    });
}
function activateMarker() {
    markerShape = new google.maps.Marker({
        map: map,
        icon: markerstyles[mcur].icon
    });
}
function initmap(){
    geocoder = new google.maps.Geocoder();
    var latlng = new google.maps.LatLng(40.768617, -111.891975);//(45.0,7.0);//40.764723, -111.896433
    var mapTypeIds = [];
    for(var type in google.maps.MapTypeId) {
        mapTypeIds.push(google.maps.MapTypeId[type]);
    }
    mapTypeIds.push("OSM");
    copyrightNode = document.createElement('div');
    copyrightNode.id = 'copyright-control';
    copyrightNode.style.fontSize = '11px';
    copyrightNode.style.fontFamily = 'Arial, sans-serif';
    copyrightNode.style.margin = '0 2px 2px 0';
    copyrightNode.style.whiteSpace = 'nowrap';
    //copyrightNode.index = 0;
    var myOptions = {
        zoom: 16,
        center: latlng,
        draggableCursor: 'default',
        draggingCursor: 'pointer',
        scaleControl: true,
        mapTypeControl: true,
        mapTypeControlOptions: {mapTypeIds: mapTypeIds},
        //mapTypeControlOptions:{style: google.maps.MapTypeControlStyle.DROPDOWN_MENU},
        mapTypeId: google.maps.MapTypeId.ROADMAP,
        styles: [{featureType: 'poi', stylers: [{visibility: 'off'}]}],
        streetViewControl: false};
    map = new google.maps.Map(gob('map_canvas'),myOptions);
    map.mapTypes.set("OSM", new google.maps.ImageMapType({
        getTileUrl: function(coord, zoom) {
            return "http://tile.openstreetmap.org/" + zoom + "/" + coord.x + "/" + coord.y + ".png";
        },
        tileSize: new google.maps.Size(256, 256),
        name: "OpenStreetMap",
        maxZoom: 18
    }));
    google.maps.event.addListener(map, 'maptypeid_changed', updateCopyrights);
    map.controls[google.maps.ControlPosition.BOTTOM_RIGHT].push(copyrightNode);

    //var myStyle = [{featureType: 'poi', stylers: [{visibility: 'off'}]}];
    //map.setOptions({styles: myStyle}); // styles and stylers are arrays
    polyPoints = new google.maps.MVCArray(); // collects coordinates
    tmpPolyLine.setMap(map);
    createplacemarkobject();
    createlinestyleobject();
    createpolygonstyleobject();
    createcirclestyleobject();
    createmarkerstyleobject();
    preparePolyline(); // create a Polyline object

    google.maps.event.addListener(map, 'click', addLatLng);
    google.maps.event.addListener(map,'zoom_changed',mapzoom);
    cursorposition(map);
}
// Called by initmap, addLatLng, drawRectangle, drawCircle, drawpolywithhole
function cursorposition(mapregion){
    google.maps.event.addListener(mapregion,'mousemove',function(point){
        var LnglatStr6 = point.latLng.lng().toFixed(6) + ', ' + point.latLng.lat().toFixed(6);
        var latLngStr6 = point.latLng.lat().toFixed(6) + ', ' + point.latLng.lng().toFixed(6);
        gob('over').options[0].text = LnglatStr6;
        gob('over').options[1].text = latLngStr6;
    });
}
function updateCopyrights() {
    if(map.getMapTypeId() == "OSM") {
        copyrightNode.innerHTML = "OSM map data @<a target=\"_blank\" href=\"http://www.openstreetmap.org/\"> OpenStreetMap</a>-contributors,<a target=\"_blank\" href=\"http://creativecommons.org/licenses/by-sa/2.0/legalcode\"> CC BY-SA</a>";
    }else{
        copyrightNode.innerHTML = "";
    }
}
function addLatLng(point){
	debugger;
    if(tinyMarker) tinyMarker.setMap(null);
    if(directionsYes == 1) {
        drawDirections(point.latLng);
        return;
    }
    if(plmcur != placemarks.length-1) {
        nextshape();
    }

    // Rectangle and circle can't collect points with getPath. solved by letting Polyline collect the points and then erase Polyline
    polyPoints = polyShape.getPath();
    // This codeline does the drawing on the map
    polyPoints.insertAt(polyPoints.length, point.latLng); // or: polyPoints.push(point.latLng)
    if(polyPoints.length == 1) {
        startpoint = point.latLng;
        placemarks[plmcur].point = startpoint; // stored because it's to be used when the shape is clicked on as a stored shape
        setstartMarker(startpoint);
        if(toolID == 5) {
            drawMarkers(startpoint);
        }
    }
    if(polyPoints.length == 2 && toolID == 3) createrectangle(point);
    if(polyPoints.length == 2 && toolID == 4) createcircle(point);
    if(toolID == 1 || toolID == 2) { // if polyline or polygon
        var stringtobesaved = point.latLng.lat().toFixed(6) + ',' + point.latLng.lng().toFixed(6);
        var kmlstringtobesaved = point.latLng.lng().toFixed(6) + ',' + point.latLng.lat().toFixed(6);
        //Cursor position, when inside polyShape, is registered with this listener
        cursorposition(polyShape);
        if(adder == 0) { //shape with no hole
            pointsArray.push(stringtobesaved); // collect textstring for presentation in textarea
            pointsArrayKml.push(kmlstringtobesaved); // collect textstring for presentation in textarea
            if(polyPoints.length == 1 && toolID == 2) closethis('polygonstuff');
            if(codeID == 1 && toolID == 1) logCode1(); // write kml for polyline
            if(codeID == 1 && toolID == 2) logCode2(); // write kml for polygon
            if(codeID == 2) logCode4(); // write Google javascript
        }
        if(adder == 1) { // adder is increased in function holecreator
            outerArray.push(stringtobesaved);
            outerArrayKml.push(kmlstringtobesaved);
        }
        if(adder == 2) {
            innerArray.push(stringtobesaved);
            innerArrayKml.push(kmlstringtobesaved);
        }
    }
}
function setstartMarker(point){
    startMarker = new google.maps.Marker({
        position: point,
        map: map});
    startMarker.setTitle("#" + polyPoints.length);
}
function createrectangle(point) {
    // startMarker is southwest point. now set northeast
    nemarker = new google.maps.Marker({
        position: point.latLng,
        draggable: true,
        raiseOnDrag: false,
        title: "Draggable",
        map: map});
    google.maps.event.addListener(startMarker, 'drag', drawRectangle);
    google.maps.event.addListener(nemarker, 'drag', drawRectangle);
    startMarker.setDraggable(true);
    startMarker.setAnimation(null);
    startMarker.setTitle("Draggable");
    polyShape.setMap(null); // remove the Polyline that has collected the points
    polyPoints = [];
    drawRectangle();
}
function drawRectangle() {
    southWest = startMarker.getPosition(); // used in logCode6()
    northEast = nemarker.getPosition(); // used in logCode6()
    var latLngBounds = new google.maps.LatLngBounds(
        southWest,
        northEast
    );
    rectangle.setBounds(latLngBounds);
    //Cursor position, when inside rectangle, is registered with this listener
    cursorposition(rectangle);
    // the Rectangle was created in activateRectangle(), called from newstart(), which may have been called from setTool()
    var northWest = new google.maps.LatLng(southWest.lat(), northEast.lng());
    var southEast = new google.maps.LatLng(northEast.lat(), southWest.lng());
    polyPoints = [];
    pointsArray = [];
    pointsArrayKml = [];
    polyPoints.push(southWest);
    polyPoints.push(northWest);
    polyPoints.push(northEast);
    polyPoints.push(southEast);
    var stringtobesaved = southWest.lng().toFixed(6)+','+southWest.lat().toFixed(6);
    pointsArrayKml.push(stringtobesaved);
    stringtobesaved = southWest.lng().toFixed(6)+','+northEast.lat().toFixed(6);
    pointsArrayKml.push(stringtobesaved);
    stringtobesaved = northEast.lng().toFixed(6)+','+northEast.lat().toFixed(6);
    pointsArrayKml.push(stringtobesaved);
    stringtobesaved = northEast.lng().toFixed(6)+','+southWest.lat().toFixed(6);
    pointsArrayKml.push(stringtobesaved);
    stringtobesaved = southWest.lat().toFixed(6)+','+southWest.lng().toFixed(6);
    pointsArray.push(stringtobesaved);
    stringtobesaved = northEast.lat().toFixed(6)+','+southWest.lng().toFixed(6);
    pointsArray.push(stringtobesaved);
    stringtobesaved = northEast.lat().toFixed(6)+','+northEast.lng().toFixed(6);
    pointsArray.push(stringtobesaved);
    stringtobesaved = southWest.lat().toFixed(6)+','+northEast.lng().toFixed(6);
    pointsArray.push(stringtobesaved);
    // Change the rectangle to polygon
    rectangle.setMap(null);
    southWest = northEast = null;
    preparePolygon();
    if(codeID == 2) logCode6();
    if(codeID == 1) logCode2();
}
function createcircle(point) {
    // startMarker is center point. now set radius
    nemarker = new google.maps.Marker({
        position: point.latLng,
        draggable: true,
        raiseOnDrag: false,
        title: "Draggable",
        map: map});
    google.maps.event.addListener(startMarker, 'drag', drawCircle);
    google.maps.event.addListener(nemarker, 'drag', drawCircle);
    startMarker.setDraggable(true);
    startMarker.setAnimation(null);
    startMarker.setTitle("Draggable");
    drawCircle();
    polyShape.setMap(null); // remove the Polyline that has collected the points
    polyPoints = [];
}
function drawCircle() {
    centerPoint = startMarker.getPosition();
    radiusPoint = nemarker.getPosition();
    circle.bindTo('center', startMarker, 'position');
    calc = distance(centerPoint.lat(),centerPoint.lng(),radiusPoint.lat(),radiusPoint.lng());
    circle.setRadius(calc);
    //Cursor position, when inside circle, is registered with this listener
    cursorposition(circle);
    codeID = gob('codechoice').value = 2;
    logCode7();
}
// calculate distance between two coordinates
function distance(lat1,lon1,lat2,lon2) {
    var R = 6371000; // earth's radius in meters
    var dLat = (lat2-lat1) * Math.PI / 180;
    var dLon = (lon2-lon1) * Math.PI / 180;
    var a = Math.sin(dLat/2) * Math.sin(dLat/2) +
    Math.cos(lat1 * Math.PI / 180 ) * Math.cos(lat2 * Math.PI / 180 ) *
    Math.sin(dLon/2) * Math.sin(dLon/2);
    var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
    var d = R * c;
    return d;
}

function drawMarkers(point) {
    if(startMarker) startMarker.setMap(null);
    if(polyShape) polyShape.setMap(null);
    var id = plmcur;
    placemarks[plmcur].jscode = point.lat().toFixed(6) + ',' + point.lng().toFixed(6);
    placemarks[plmcur].kmlcode = point.lng().toFixed(6) + ',' + point.lat().toFixed(6);
    activateMarker();
    markerShape.setPosition(point);
    var marker = markerShape;
    tinyMarker = new google.maps.Marker({
        position: placemarks[plmcur].point,
        map: map,
        icon: tinyIcon
    });
    google.maps.event.addListener(marker, 'click', function(event){
	    debugger;
        plmcur = id;
        markerShape = marker;
        var html = "<b>" + placemarks[plmcur].name + "</b> <br/>" + placemarks[plmcur].desc;
        infowindow.setContent(html);
        if(tinyMarker) tinyMarker.setMap(null);
        tinyMarker = new google.maps.Marker({
            position: placemarks[plmcur].point,
            map: map,
            icon: tinyIcon
        });
        if(toolID != 5) toolID = gob('toolchoice').value = 5;
        if(codeID == 1)logCode9();
        if(codeID == 2)logCode8();
        infowindow.open(map,marker);
    });
    drawnShapes.push(markerShape);
    if(codeID == 2) logCode8();
    if(codeID == 1) logCode9();
}
function drawDirections(point) {
    if(firstdirclick > 2) {
        //if(oldpoint) waypts.push({location:oldpoint, stopover:true});
        var request = {
            origin: dirpointstart,
            destination: point,
            waypoints: waypts,
            travelMode: google.maps.DirectionsTravelMode.DRIVING
        };
        //oldpoint = point;
        waypts.push({location:point, stopover:true});
        destinations.push(request.destination);
        calcRoute(request);
    }
    if(firstdirclick == 2) {
        request = {
            origin: dirpointstart,
            destination: point,
            travelMode: google.maps.DirectionsTravelMode.DRIVING
        };
        //oldpoint = point;
        waypts.push({location:point, stopover:true});
        destinations.push(request.destination);
        calcRoute(request);
    }
    if(dirpointstart == null) {
        dirpointstart = point;
        firstdirclick = 1;
        //increaseplmcur(); // not necessary?
        dirline = plmcur;
        placemarks[dirline].shape = polyShape; // created in preparePolyline(), initiated in newstart() called from setTool()
        placemarks[dirline].point = dirpointstart;
        directionsDisplay = new google.maps.DirectionsRenderer({
            suppressMarkers: true,
            preserveViewport: true
        });
        request = {
            origin: dirpointstart,
            destination: point,
            travelMode: google.maps.DirectionsTravelMode.DRIVING
        };
        //destinations.push(request.destination);
        calcRoute(request);

        //dirpointend = 1;
        dircountstart = dirline+1;
    }
}
//}
function calcRoute(request) {
    directionsDisplay.setOptions({polylineOptions: {
        strokeColor: polylinestyles[lcur].color,
        strokeOpacity: polylinestyles[lcur].lineopac,
        strokeWeight: polylinestyles[lcur].width}});
    if(firstdirclick == 1) directionsDisplay.setMap(map);
    firstdirclick++;
    directionsService.route(request, RenderCustomDirections);
}
function RenderCustomDirections(response, status) {
    if (status == google.maps.DirectionsStatus.OK) {
        //var m = step + 1;
        //if(removedirectionleg == 1) m = m - 1;
        directionsDisplay.setDirections(response);
        var result = directionsDisplay.getDirections().routes[0];
        var legs = response.routes[0].legs;
        polyPoints = [];
        pointsArray = [];
        pointsArrayKml = [];
        /*if(firstdirclick > 2) {
            result.overview_path.shift();
        }*/
        for(var i = 0; i < result.overview_path.length; i++) {
            polyPoints.push(result.overview_path[i]);
            pointsArray.push(result.overview_path[i].lat().toFixed(6) + ',' + result.overview_path[i].lng().toFixed(6));
            pointsArrayKml.push(result.overview_path[i].lng().toFixed(6) + ',' + result.overview_path[i].lat().toFixed(6));
        }
        polyShape.setPath(polyPoints);
        endLocation = new Object();
        if (step == 0) {
            createdirMarker(legs[step].start_location,legs[step].start_address);
            markersArray.push(legs[step].start_location.lat().toFixed(6) + ',' + legs[step].start_location.lng().toFixed(6));
            markersArrayKml.push(legs[step].start_location.lng().toFixed(6) + ',' + legs[step].start_location.lat().toFixed(6));
            addresssArray.push(legs[step].start_address);
            //placemarks[plmcur].name = "Marker "+dirmarknum;
        }
        if(step>0 && removedirectionleg==0) {
            endLocation.latlng = legs[step-1].end_location;
            endLocation.address = legs[step-1].end_address;
            createdirMarker(endLocation.latlng,endLocation.address);
            markersArray.push(endLocation.latlng.lat().toFixed(6) + ',' + endLocation.latlng.lng().toFixed(6));
            markersArrayKml.push(endLocation.latlng.lng().toFixed(6) + ',' + endLocation.latlng.lat().toFixed(6));
            addresssArray.push(endLocation.address);
            //placemarks[plmcur].name = "Marker "+dirmarknum;
        }
        removedirectionleg = 0;
        //logCode1a();
        //dirmarknum++;
        step++;
        //placemarks[plmcur].desc = addresssArray[addresssArray.length-1];
        docudetails();
        //showthis('toppers');
    }
    else alert(status);
}
function createdirMarker(latlng, html) {
    if(tinyMarker) tinyMarker.setMap(null);
    createplacemarkobject();
    plmcur++; // plmcur = placemarks.length -1;
    activateMarker();
    placemarks[plmcur].name = "Marker "+dirmarknum;
    markerShape.setTitle(placemarks[plmcur].name+"\n"+html);
    markerShape.setPosition(latlng);
    placemarks[plmcur].jscode = latlng.lat().toFixed(6) + ',' + latlng.lng().toFixed(6);
    placemarks[plmcur].kmlcode = latlng.lng().toFixed(6) + ',' + latlng.lat().toFixed(6);
    placemarks[plmcur].desc = html;
    placemarks[plmcur].point = latlng;
    placemarks[plmcur].style = markerstyles[mcur].name;
    placemarks[plmcur].stylecur = mcur;
    placemarks[plmcur].shape = markerShape;
    drawnShapes.push(markerShape);
    dirmarknum++;
    var marker = markerShape;
    var thisshape = plmcur;
    google.maps.event.addListener(marker, 'click', function(event){
	    debugger;
        markerShape = marker;
        plmcur = thisshape;
        //var htm = "<b>" + placemarks[thisshape].name + "</b> <br/>" + placemarks[thisshape].desc;
        if(polyPoints == 0) {
            //infowindow.setContent(htm);
            if(tinyMarker) tinyMarker.setMap(null);
            tinyMarker = new google.maps.Marker({
                position: placemarks[plmcur].point,
                map: map,
                icon: tinyIcon
            });
            if(toolID != 5) {
                toolID = gob('toolchoice').value = 5;
                directionsYes = 0;
            }
            if(codeID == 1) logCode9();
            if(codeID == 2) logCode8();
            //infowindow.open(map,marker);
        }
    });
    drawnShapes.push(markerShape);
}
// Called from deleteLastPoint() initiated by click on button
function undo() {
    if(drawnShapes.length > 1) {
        drawnShapes[drawnShapes.length-1].setMap(null);
        destinations.pop();
        var point = destinations[destinations.length-1];
        waypts.pop();
        var request = {
            origin: dirpointstart,
            destination: point,
            waypoints: waypts,
            travelMode: google.maps.DirectionsTravelMode.DRIVING
        };
        placemarks.pop();
        markersArray.pop();
        markersArrayKml.pop();
        addresssArray.pop();
        firstdirclick = firstdirclick-1;
        step = step-1;
        dirmarknum = dirmarknum-1;
        plmcur = plmcur-1;
        removedirectionleg = 1;
        calcRoute(request);
    }
}

// Not used
function setDirectionsMarker(point) {
    var image = new google.maps.MarkerImage('http://www.birdtheme.org/useful/images/square.png');
    var marker = new google.maps.Marker({
        position: point,
        map: map,
        icon: image
    });
    /*var shadow = new google.maps.MarkerImage('http://maps.google.com/intl/en_us/mapfiles/ms/micons/msmarker.shadow.png',
        new google.maps.Size(37,32),
        new google.maps.Point(16,0),
        new google.maps.Point(0,32));
    var title = "#" + markers.length;
    var id = plmcur;
    placemarks[plmcur].point = point;
    placemarks[plmcur].coord = point.lng().toFixed(6) + ', ' + point.lat().toFixed(6);*/
    /*var marker = new google.maps.Marker({
        position: point,
        map: map,
        draggable: true,
        icon: image,
        shadow: shadow});*/
    //marker.setTitle(title);
    //markers.push(marker);
}

function setTool(){
    if(polyPoints.length == 0 && kmlcode == "" && javacode == "") {
        newstart();
    }else{
        if(toolID == 1){ // polyline
            // change to polyline draw mode not allowed
            if(outerArray.length > 0) { //indicates polygon with hole
                toolID = 2;
                nextshape();
                toolID = 1;
                newstart();
                return;
            }
            if(rectangle) {
                toolID = 3;
                nextshape();
                toolID = 1;
                newstart();
                return;
            }
            if(circle) {
                toolID = 4;
                nextshape();
                toolID = 1;
                newstart();
                return;
            }
            if(markerShape) {
                toolID = 5;
                nextshape();
                toolID = 1;
                newstart();
                return;
            }
            if(directionsYes == 1) {
                toolID = 6;
                nextshape();
                directionsYes = 0;
                toolID = 1;
                newstart();
                return;
            }
            placemarks[plmcur].style = polylinestyles[polylinestyles.length-1].name;
            placemarks[plmcur].stylecur = polylinestyles.length-1;
            if(polyShape) polyShape.setMap(null);
            preparePolyline(); //if a polygon exists, it will be redrawn as polylines
            if(codeID == 1) logCode1(); // KML
            if(codeID == 2) logCode4(); // Javascipt
        }
        if(toolID == 2){ // polygon
            if(rectangle) {
                toolID = 3;
                nextshape();
                toolID = 2;
                newstart();
                return;
            }
            if(circle) {
                toolID = 4;
                nextshape();
                toolID = 2;
                newstart();
                return;
            }
            if(markerShape) {
                toolID = 5;
                nextshape();
                toolID = 2;
                newstart();
                return;
            }
            if(directionsYes == 1) {
                toolID = 6;
                nextshape();
                directionsYes = 0;
                toolID = 2;
                newstart();
                return;
            }
            placemarks[plmcur].style = polygonstyles[polygonstyles.length-1].name;
            placemarks[plmcur].stylecur = polygonstyles.length-1;
            if(polyShape) polyShape.setMap(null);
            preparePolygon(); //if a polyline exists, it will be redrawn as a polygon
            if(codeID == 1) logCode2(); // KML
            if(codeID == 2) logCode4(); // Javascript
        }
        if(toolID == 3 || toolID == 4 || toolID == 5 || toolID == 6){
            if(polyShape) polyShape.setMap(null);
            if(circle) circle.setMap(null);
            if(rectangle) rectangle.setMap(null);
            directionsYes = 0;
            newstart();
        }
    }
}
function setCode(){
    if(toolID == 4) { // circle
        codeID = gob('codechoice').value = 2; // javascript
        return;
    }
    if(toolID == 6) { // directions
        codeID = gob('codechoice').value = 1; // KML
        return;
    }
    if(polyPoints.length !== 0 || kmlcode !== "" || javacode !== ""){
        if(codeID == 1 && toolID == 1) logCode1();
        if(codeID == 1 && toolID == 2 && outerArray.length == 0) logCode2();
        if(codeID == 1 && toolID == 2 && outerArray.length > 0) logCode3();
        if(codeID == 2 && toolID == 1) logCode4(); // write Google javascript
        if(codeID == 2 && toolID == 2 && outerArray.length == 0) logCode4();
        if(codeID == 2 && toolID == 2 && outerArray.length > 0) logCode5();
        if(toolID == 3) { // rectangle
            if(codeID == 1) logCode2();
            if(codeID == 2) logCode6();
        }
        if(toolID == 5) { // marker
            if(codeID == 1) logCode9();
            if(codeID == 2) logCode8();
        }
    }
}
function increaseplmcur() {
    if(placemarks[plmcur].plmtext != "") {
        if(polyShape && directionsYes == 0) {
            placemarks[plmcur].shape = polyShape;
            if(toolID==1 || toolID==2 || toolID==3) addpolyShapelistener();
            createplacemarkobject();
            plmcur = placemarks.length -1;
        }
        if(markerShape && directionsYes == 0) {
            placemarks[plmcur].shape = markerShape;
            createplacemarkobject();
            plmcur = placemarks.length -1;
        }
        //Set a listener on the directions line (path)
        if(directionsYes == 1) {
            placemarks[plmcur].shape = polyShape;
            plmcur = dirline;
            addpolyShapelistener();
            createplacemarkobject();
            plmcur = placemarks.length -1;
        }
    }
}
//Saving of data for current shape on the map will be completed and a listener set on it
//Then all variables will be nulled in newstart
function nextshape() {
    if(editing == true) stopediting();
    //If a saved shape has been inspected, set a new listener on it
    if(plmcur < placemarks.length -1) {
        addpolyShapelistener();
        plmcur = placemarks.length -1;
    }
    //Set listener on current shape. Create new placemark object.
    //Increase counter for placemark
    increaseplmcur();
    if(polyShape) drawnShapes.push(polyShape); // used in clearMap, to have it removed from the map, drawnShapes[i].setMap(null)
    if(outerShape) drawnShapes.push(outerShape);
    if(circle) drawnShapes.push(circle);
    if(tinyMarker) drawnShapes.push(tinyMarker);
    // markerShape has been pushed in drawMarkers and createdirMarker, rectangle has been converted to polygon
    polyShape = null;
    outerShape = null;
    rectangle = null;
    circle = null;
    markerShape = null;
    //directionsDisplay = null;
    newstart();
}
function addpolyShapelistener() {
    var thisshape = plmcur;
    // In v2 I can give a shape an ID and have that ID revealed, with the map listener, when the shape is clicked on
    // I can't do that in v3. Instead I put a listener on the shape
    google.maps.event.addListener(polyShape,'click',function(point){
	    debugger;
        if(tinyMarker) tinyMarker.setMap(null);
        if(startMarker) startMarker.setMap(null);
        directionsYes = 0;
        polyShape = placemarks[thisshape].shape;
        plmcur = thisshape;
        polyPoints = polyShape.getPath();
        if(placemarks[plmcur].poly == "pl") {
            pointsArray = placemarks[plmcur].jscode;
            pointsArrayKml = placemarks[plmcur].kmlcode;
            toolID = gob('toolchoice').value = 1;
            lcur = placemarks[plmcur].stylecur;
            if(codeID == 1) logCode1();
            if(codeID == 2) logCode4(); // write Google javascript
        }
        if(placemarks[plmcur].poly == "pg") {
            pointsArray = placemarks[plmcur].jscode;
            pointsArrayKml = placemarks[plmcur].kmlcode;
            toolID = gob('toolchoice').value = 2;
            pcur = placemarks[plmcur].stylecur;
            if(codeID == 1) logCode2();
            if(codeID == 2) logCode4(); // write Google javascript
        }
        if(placemarks[plmcur].poly == "pgh") {
            outerArrayKml = placemarks[plmcur].kmlcode;
            innerArraysKml = placemarks[plmcur].kmlholecode;
            /*var polly = polyShape.getPaths();
            polyPoints = polly.getAt(0);
            var points = polly.getAt(0);
            //alert(point.lng().toFixed(6));
            for(var i = 0; i<points.length-1; i++) {
                outerArray.push(points.getAt(i).lat().toFixed(6) + ',' + points.getAt(i).lng().toFixed(6));
                outerArrayKml.push(points.getAt(i).lng().toFixed(6) + ',' + points.getAt(i).lat().toFixed(6));
            }
            for(i = 1; i<polly.length; i++) {
                points = polly.getAt(i);
                if(i == polly.length-1) {
                    for(var j = 0; j<points.length; j++) {
                        innerArray.push(points.getAt(j).lat().toFixed(6) + ',' + points.getAt(j).lng().toFixed(6));
                        innerArrayKml.push(points.getAt(j).lng().toFixed(6) + ',' + points.getAt(j).lat().toFixed(6));
                    }
                }else{
                    for(var j = 0; j<points.length-1; j++) {
                        innerArray.push(points.getAt(j).lat().toFixed(6) + ',' + points.getAt(j).lng().toFixed(6));
                        innerArrayKml.push(points.getAt(j).lng().toFixed(6) + ',' + points.getAt(j).lat().toFixed(6));
                    }
                }
                innerArrays.push(innerArray);
                innerArraysKml.push(innerArrayKml);
                innerArray = [];
                innerArrayKml = [];
            }*/
            toolID = gob('toolchoice').value = 2;
            pcur = placemarks[plmcur].stylecur;
            if(codeID == 1) logCode3();
            if(codeID == 2) logCode5(); // write Google javascript
        }
        //polyPoints = polyShape.getPath();
        //polyShape.setEditable(true);
        tinyMarker = new google.maps.Marker({
            position: placemarks[plmcur].point,
            map: map,
            icon: tinyIcon
        });
        closethis('polygonstuff');
    });
}
// Clear current Map
function clearMap(){
    if(editing == true) stopediting();
    if(polyShape) polyShape.setMap(null); // polyline or polygon
    if(outerShape) outerShape.setMap(null);
    if(rectangle) rectangle.setMap(null);
    if(circle) circle.setMap(null);
    if(drawnShapes.length > 0) {
        for(var i = 0; i < drawnShapes.length; i++) {
            drawnShapes[i].setMap(null);
        }
    }
    plmcur = 0;
    dirmarknum = 1;
    newstart();
    placemarks = [];
    createplacemarkobject();
}
function newstart() {
    polyPoints = [];
    outerPoints = [];
    pointsArray = [];
    markersArray = [];
    pointsArrayKml = [];
    markersArrayKml = [];
    addresssArray = [];
    outerArray = [];
    innerArray = [];
    outerArrayKml = [];
    innerArrayKml = [];
    holePolyArray = [];
    innerArrays = [];
    innerArraysKml = [];
    waypts = [];
    destinations = [];
    adder = 0;
    dirpointstart = null;
    dirline = null;
    firstdirclick = 0;
    //dirmarknum = 1;
    step = 0;
    if(directionsYes == 1 && toolID != 6) directionsYes = 0;
    closethis('polylineoptions');
    closethis('polygonoptions');
    closethis('circleoptions');
    if(toolID != 2) closethis('polygonstuff');
    if(directionsDisplay) directionsDisplay.setMap(null);
    if(startMarker) startMarker.setMap(null);
    if(nemarker) nemarker.setMap(null);
    if(tinyMarker) tinyMarker.setMap(null);
    if(toolID == 1) {
        placemarks[plmcur].style = polylinestyles[polylinestyles.length-1].name;
        placemarks[plmcur].stylecur = polylinestyles.length-1;
        preparePolyline();
        polylineintroduction();
    }
    if(toolID == 2){
        showthis('polygonstuff');
        gob('stepdiv').innerHTML = "Step 0";
        placemarks[plmcur].style = polygonstyles[polygonstyles.length-1].name;
        placemarks[plmcur].stylecur = polygonstyles.length-1;
        preparePolygon();
        polygonintroduction();
    }
    if(toolID == 3) {
        placemarks[plmcur].style = polygonstyles[polygonstyles.length-1].name;
        placemarks[plmcur].stylecur = polygonstyles.length-1;
        preparePolyline(); // use Polyline to collect clicked point
        activateRectangle();
        rectangleintroduction();
    }
    if(toolID == 4) {
        placemarks[plmcur].style = circlestyles[circlestyles.length-1].name;
        placemarks[plmcur].stylecur = circlestyles.length-1;
        preparePolyline(); // use Polyline to collect clicked point
        activateCircle();
        circleintroduction();
        codeID = gob('codechoice').value = 2; // javascript, no KML for circle
    }
    if(toolID == 5) {
        placemarks[plmcur].style = markerstyles[markerstyles.length-1].name;
        placemarks[plmcur].stylecur = markerstyles.length-1;
        preparePolyline();
        markerintroduction();
    }
    if(toolID == 6){
        directionsYes = 1;
        /*if(dirline != null) {
            placemarks[plmcur].style = placemarks[dirline].style;
            placemarks[plmcur].stylecur = placemarks[dirline].stylecur;
        }else{*/
            placemarks[plmcur].style = polylinestyles[polylinestyles.length-1].name;
            placemarks[plmcur].stylecur = polylinestyles.length-1;
        //}
        preparePolyline();
        directionsintroduction();
        codeID = gob('codechoice').value = 1;
    }
    kmlcode = "";
    javacode = "";
}

function deleteLastPoint(){
    if(polyPoints.length < 2) return;
    if(directionsYes == 1) {
        if(destinations.length == 1) return;
        undo();
        return;
    }
    if(toolID == 1) {
        if(polyShape) {
            polyPoints = polyShape.getPath();
            if(polyPoints.length > 0) {
                polyPoints.removeAt(polyPoints.length-1);
                pointsArrayKml.pop();
                if(codeID == 1) logCode1();
                if(codeID == 2) logCode4();
            }
        }
    }
    if(toolID == 2) {
        if(innerArrayKml.length>0) {
            innerArrayKml.pop();
            polyPoints.removeAt(polyPoints.length-1);
        }
        if(outerArrayKml.length>0 && innerArrayKml.length==0) {
            outerArrayKml.pop();
            //polyPoints.removeAt(polyPoints.length-1);
        }
        if(outerPoints.length===0) {
            if(polyShape) {
                polyPoints = polyShape.getPath();
                if(polyPoints.length > 0) {
                    polyPoints.removeAt(polyPoints.length-1);
                    pointsArrayKml.pop();
                    if(adder == 0) {
                        if(codeID == 1) logCode2();
                        if(codeID == 2) logCode4();
                    }
                }
            }
        }
    }
    if(polyPoints.length === 0) nextshape();
}
function counter(num){
    return adder = adder + num;
}
// Called from link 'Hole' in div 'polygonstuff'
function holecreator(){
    var holestep = counter(1); // adder is increased here
    if(holestep == 1){
        if(gob('stepdiv').innerHTML == "Finished"){
            adder = 0;
            return;
        }else{
            if(startMarker) startMarker.setMap(null);
            if(polyShape) polyShape.setMap(null);
            polyPoints = [];
            preparePolyline();
            gob('stepdiv').innerHTML = "Step 1";
            gob('coords1').value = 'You may now draw the outer boundary. When finished, click Hole to move on to the next step.'
            +' Remember, you do not have to let start and end meet.'
            +' The API will close the shape in the finished polygon.';
        }
    }
    if(holestep == 2){
        // innerArray and innerArrayKml will be collected in function addLatLng
        if(anotherhole == false) {
            // outer line is finished, in Polyline draw mode
            polyPoints.insertAt(polyPoints.length, startpoint); // let start and end for outer line meet
            outerPoints = polyPoints; // store polyPoints in outerPoints. polyPoints will be reused for inner lines
            holePolyArray.push(outerPoints); // this will be the points array for polygon with hole when the points for inner lines are added
            outerShape = polyShape; // store polyShape in outerShape. polyShape will be reused for inner lines
        }
        gob('stepdiv').innerHTML = "Step 2";
        gob('coords1').value = 'You may now draw an inner boundary. Click Hole again to see the finished polygon. '+
        'You may draw more than one hole: Click Next hole and draw before you click Hole.';
        if(anotherhole == true) { // set to true in nexthole
            // a hole has been drawn, another is about to be drawn
            if(polyShape && polyPoints.length == 0) {
                polyShape.setMap(null);
                gob('coords1').value = 'Oops! Not programmed yet, but you may continue drawing holes. '+
                'Everything you have created will show up when you click Hole again.';
            }else{
                polyPoints.insertAt(polyPoints.length, startpoint);
                holePolyArray.push(polyPoints);
                if(innerArray.length>0) innerArrays.push(innerArray);
                if(innerArrayKml.length>0) innerArraysKml.push(innerArrayKml);
                holeShapes.push(polyShape);
                innerArray = [];
                innerArrayKml = [];
            }
        }
        polyPoints = [];
        preparePolyline();
        if(startMarker) startMarker.setMap(null);
    }
    if(holestep == 3){
        if(startMarker) startMarker.setMap(null);
        if(outerShape) outerShape.setMap(null);
        if(polyShape) polyShape.setMap(null);
        if(polyPoints.length>0) holePolyArray.push(polyPoints);
        if(innerArray.length>0) innerArrays.push(innerArray);
        if(innerArrayKml.length>0) innerArraysKml.push(innerArrayKml);
        drawpolywithhole();
        gob('stepdiv').innerHTML = "Finished";
        adder = 0;
        if(codeID == 1) logCode3();
        if(codeID == 2) logCode5();
    }
}
function drawpolywithhole() {
    if(holeShapes.length > 0) {
        for(var i = 0; i < holeShapes.length; i++) {
            holeShapes[i].setMap(null);
        }
    }
    var Points = new google.maps.MVCArray(holePolyArray);
    var polyOptions = {
        paths: Points,
        strokeColor: polygonstyles[pcur].color,
        strokeOpacity: polygonstyles[pcur].lineopac,
        strokeWeight: polygonstyles[pcur].width,
        fillColor: polygonstyles[pcur].fill,
        fillOpacity: polygonstyles[pcur].fillopac
    };
    polyShape = new google.maps.Polygon(polyOptions);
    polyShape.setMap(map);
    //Cursor position, when inside polyShape, is registered with this listener
    cursorposition(polyShape);
    anotherhole = false;
    if(startMarker) startMarker.setMap(null);
    startMarker = new google.maps.Marker({
        position: outerPoints.getAt(0),
        map: map});
    startMarker.setTitle("Polygon with hole");
    placemarks[plmcur].point = outerPoints.getAt(0);
}
// Called from button 'Next hole' in div 'polygonstuff'
function nexthole() {
    if(gob('stepdiv').innerHTML != "Finished") {
        if(outerPoints.length > 0) {
            adder = 1;
            anotherhole = true;
            drawnShapes.push(polyShape);
            holecreator();
        }
    }
}
function stopediting(){
    editing = false;
    gob('EditButton').value = 'Edit lines';
    closethis('RegretButton');
    if(outerArray.length > 0) {
        polyShape.setEditable(false);
        outerArray = [];
        outerArrayKml = [];
        innerArray = [];
        innerArrays = [];
        innerArrayKml = [];
        innerArraysKml = [];
        var polly = polyShape.getPaths();
        polyPoints = polly.getAt(0);
        var points = polly.getAt(0);
        //alert(point.lng().toFixed(6));
        for(var i = 0; i<points.length-1; i++) {
            outerArray.push(points.getAt(i).lat().toFixed(6) + ',' + points.getAt(i).lng().toFixed(6));
            outerArrayKml.push(points.getAt(i).lng().toFixed(6) + ',' + points.getAt(i).lat().toFixed(6));
        }
        for(i = 1; i<polly.length; i++) {
            points = polly.getAt(i);
            if(i == polly.length-1) {
                for(var j = 0; j<points.length; j++) {
                    innerArray.push(points.getAt(j).lat().toFixed(6) + ',' + points.getAt(j).lng().toFixed(6));
                    innerArrayKml.push(points.getAt(j).lng().toFixed(6) + ',' + points.getAt(j).lat().toFixed(6));
                }
            }else{
                for(var j = 0; j<points.length-1; j++) {
                    innerArray.push(points.getAt(j).lat().toFixed(6) + ',' + points.getAt(j).lng().toFixed(6));
                    innerArrayKml.push(points.getAt(j).lng().toFixed(6) + ',' + points.getAt(j).lat().toFixed(6));
                }
            }
            innerArrays.push(innerArray);
            innerArraysKml.push(innerArrayKml);
            innerArray = [];
            innerArrayKml = [];
        }
        toolID = gob('toolchoice').value = 2;
        //closethis('polygonstuff');
        pcur = placemarks[plmcur].stylecur;
        if(codeID == 1) logCode3();
        if(codeID == 2) logCode5(); // write Google javascript
    }else{
        for(var i = 0; i < markers.length; i++) {
            markers[i].setMap(null);
        }
        for(var i = 0; i < midmarkers.length; i++) {
            midmarkers[i].setMap(null);
        }
        polyPoints = polyShape.getPath();
        markers = [];
        midmarkers = [];
        if(plmcur != placemarks.length-1) {
            placemarks[plmcur].shape = polyShape;
            drawnShapes.push(polyShape);
            addpolyShapelistener();
        }
        //setstartMarker(polyPoints.getAt(0));
    }
}
// the "Edit lines" button has been pressed
function editlines(){
    if(editing == true){
        stopediting();
    }else{
        if(outerArray.length > 0) {
            polyShape.setEditable(true);
            closethis('polygonstuff');
        }else{
            //polyPoints = polyShape.getPath();
            if(polyPoints.length > 0){
                showthis('RegretButton');
                toolID = gob('toolchoice').value = 1; // editing is set to be possible only in polyline draw mode
                setTool();
                if(startMarker) startMarker.setMap(null);
                /*polyShape.setOptions({
                    editable: true
                });*/
                for(var i = 0; i < polyPoints.length; i++) {
                    var marker = setmarkers(polyPoints.getAt(i));
                    markers.push(marker);
                    if(i > 0) {
                        var previous = polyPoints.getAt(i-1);
                        var midmarker = setmidmarkers(polyPoints.getAt(i),previous);
                        midmarkers.push(midmarker);
                    }
                }
            }
        }
        editing = true;
        gob('EditButton').value = 'Stop edit';
    }
}
function regret(){
    if(polyPoints.length == 0) return;
    for(var i = 0; i < markers.length; i++) {
        markers[i].setMap(null);
    }
    for(var i = 0; i < midmarkers.length; i++) {
        midmarkers[i].setMap(null);
    }
    polyPoints.insertAt(prevnumber, prevpoint);
    polyShape.setPath(polyPoints);
    //editing = false;
    stopediting();
    editlines();
}
// Called from editlines and listener set in setmidmarkers
function setmarkers(point) {
    var marker = new google.maps.Marker({
    	position: point,
    	map: map,
    	icon: imageNormal,
        raiseOnDrag: false,
    	draggable: true
    });
    google.maps.event.addListener(marker, "mouseover", function() {
    	marker.setIcon(imageHover);
    });
    google.maps.event.addListener(marker, "mouseout", function() {
    	marker.setIcon(imageNormal);
    });
    google.maps.event.addListener(marker, "drag", function() {
        for (var i = 0; i < markers.length; i++) {
            if (markers[i] == marker) {
                prevpoint = marker.getPosition();
                prevnumber = i;
                polyShape.getPath().setAt(i, marker.getPosition());
                movemidmarker(i);
                break;
            }
        }
        polyPoints = polyShape.getPath();
        var stringtobesaved = marker.getPosition().lat().toFixed(6) + ',' + marker.getPosition().lng().toFixed(6);
        var kmlstringtobesaved = marker.getPosition().lng().toFixed(6) + ',' + marker.getPosition().lat().toFixed(6);
        pointsArray.splice(i,1,stringtobesaved);
        pointsArrayKml.splice(i,1,kmlstringtobesaved);
        logCode1();
    });
    google.maps.event.addListener(marker, "click", function() {
	    debugger;
        for (var i = 0; i < markers.length; i++) {
            if (markers[i] == marker && markers.length != 1) {
                prevpoint = marker.getPosition();
                prevnumber = i;
                marker.setMap(null);
                markers.splice(i, 1);
                polyShape.getPath().removeAt(i);
                removemidmarker(i);
                break;
            }
        }
        polyPoints = polyShape.getPath();
        if(markers.length > 0) {
            pointsArray.splice(i,1);
            pointsArrayKml.splice(i,1);
            logCode1();
        }
    });
    return marker;
}
// Called from editlines and listener set in this function
function setmidmarkers(point,prevpoint) {
    //var prevpoint = markers[markers.length-2].getPosition();
    var marker = new google.maps.Marker({
    	position: new google.maps.LatLng(
    		point.lat() - (0.5 * (point.lat() - prevpoint.lat())),
    		point.lng() - (0.5 * (point.lng() - prevpoint.lng()))
    	),
    	map: map,
    	icon: imageNormalMidpoint,
        raiseOnDrag: false,
    	draggable: true
    });
    google.maps.event.addListener(marker, "mouseover", function() {
    	marker.setIcon(imageHover);
    });
    google.maps.event.addListener(marker, "mouseout", function() {
    	marker.setIcon(imageNormalMidpoint);
    });
    google.maps.event.addListener(marker, "dragstart", function() {
    	for (var i = 0; i < midmarkers.length; i++) {
    		if (midmarkers[i] == marker) {
    			var tmpPath = tmpPolyLine.getPath();
    			tmpPath.push(markers[i].getPosition());
    			tmpPath.push(midmarkers[i].getPosition());
    			tmpPath.push(markers[i+1].getPosition());
    			break;
    		}
    	}
    });
    google.maps.event.addListener(marker, "drag", function() {
    	for (var i = 0; i < midmarkers.length; i++) {
    		if (midmarkers[i] == marker) {
    			tmpPolyLine.getPath().setAt(1, marker.getPosition());
    			break;
    		}
    	}
    });
    google.maps.event.addListener(marker, "dragend", function() {
    	for (var i = 0; i < midmarkers.length; i++) {
    		if (midmarkers[i] == marker) {
    			var newpos = marker.getPosition();
    			var startMarkerPos = markers[i].getPosition();
    			var firstVPos = new google.maps.LatLng(
    				newpos.lat() - (0.5 * (newpos.lat() - startMarkerPos.lat())),
    				newpos.lng() - (0.5 * (newpos.lng() - startMarkerPos.lng()))
    			);
    			var endMarkerPos = markers[i+1].getPosition();
    			var secondVPos = new google.maps.LatLng(
    				newpos.lat() - (0.5 * (newpos.lat() - endMarkerPos.lat())),
    				newpos.lng() - (0.5 * (newpos.lng() - endMarkerPos.lng()))
    			);
    			var newVMarker = setmidmarkers(secondVPos,startMarkerPos);
    			newVMarker.setPosition(secondVPos);//apply the correct position to the midmarker
    			var newMarker = setmarkers(newpos);
    			markers.splice(i+1, 0, newMarker);
    			polyShape.getPath().insertAt(i+1, newpos);
    			marker.setPosition(firstVPos);
    			midmarkers.splice(i+1, 0, newVMarker);
    			tmpPolyLine.getPath().removeAt(2);
    			tmpPolyLine.getPath().removeAt(1);
    			tmpPolyLine.getPath().removeAt(0);
    			/*newpos = null;
    			startMarkerPos = null;
    			firstVPos = null;
    			endMarkerPos = null;
    			secondVPos = null;
    			newVMarker = null;
    			newMarker = null;*/
    			break;
    		}
    	}
        polyPoints = polyShape.getPath();
        var stringtobesaved = newpos.lat().toFixed(6) + ',' + newpos.lng().toFixed(6);
        var kmlstringtobesaved = newpos.lng().toFixed(6) + ',' + newpos.lat().toFixed(6);
        pointsArray.splice(i+1,0,stringtobesaved);
        pointsArrayKml.splice(i+1,0,kmlstringtobesaved);
        logCode1();
    });
    return marker;
}
// Called from listener set in setmarkers
function movemidmarker(index) {
    var newpos = markers[index].getPosition();
    if (index != 0) {
    	var prevpos = markers[index-1].getPosition();
    	midmarkers[index-1].setPosition(new google.maps.LatLng(
    		newpos.lat() - (0.5 * (newpos.lat() - prevpos.lat())),
    		newpos.lng() - (0.5 * (newpos.lng() - prevpos.lng()))
    	));
    	//prevpos = null;
    }
    if (index != markers.length - 1) {
    	var nextpos = markers[index+1].getPosition();
    	midmarkers[index].setPosition(new google.maps.LatLng(
    		newpos.lat() - (0.5 * (newpos.lat() - nextpos.lat())),
    		newpos.lng() - (0.5 * (newpos.lng() - nextpos.lng()))
    	));
    	//nextpos = null;
    }
    //newpos = null;
    //index = null;
}
// Called from listener set in setmarkers
function removemidmarker(index) {
    if (markers.length > 0) {//clicked marker has already been deleted
    	if (index != markers.length) {
    		midmarkers[index].setMap(null);
    		midmarkers.splice(index, 1);
    	} else {
    		midmarkers[index-1].setMap(null);
    		midmarkers.splice(index-1, 1);
    	}
    }
    if (index != 0 && index != markers.length) {
    	var prevpos = markers[index-1].getPosition();
    	var newpos = markers[index].getPosition();
    	midmarkers[index-1].setPosition(new google.maps.LatLng(
    		newpos.lat() - (0.5 * (newpos.lat() - prevpos.lat())),
    		newpos.lng() - (0.5 * (newpos.lng() - prevpos.lng()))
    	));
    	//prevpos = null;
    	//newpos = null;
    }
    //index = null;
}
function showKML() {
    if(codeID != 1) {
        codeID = gob('codechoice').value = 1; // set KML
        setCode();
    }
    gob('coords1').value = kmlheading();
    for (var i = 0; i < placemarks.length; i++) {
        gob('coords1').value += placemarks[i].plmtext;
    }
    gob('coords1').value += kmlend();
}
function showAddress(address) {
    geocoder.geocode({'address': address}, function(results, status) {
        if (status == google.maps.GeocoderStatus.OK) {
            var pos = results[0].geometry.location;
            map.setCenter(pos);
            tinyMarker = new google.maps.Marker({
                position: pos,
                map: map,
                icon: tinyIcon
            });
            drawnShapes.push(tinyMarker);
            if(directionsYes == 1) drawDirections(pos);
            if(toolID == 5) drawMarkers(pos);
        } else {
            alert("Geocode was not successful for the following reason: " + status);
        }
    });
}
function activateDirections() {
    directionsYes = 1;
    directionsintroduction();
}
function closethis(name){
    gob(name).style.visibility = 'hidden';
}
function showthis(name){
    gob(name).style.visibility = 'visible';
}
function docudetails(){
    if(directionsYes == 1) {
        if(dirline == null) dirline = plmcur;
        gob("dirplm1").value = placemarks[dirline].name;
        gob("dirplm2").value = placemarks[dirline].desc;
        gob("dirplm3").value = placemarks[dirline].tess;
        gob("dirplm4").value = placemarks[dirline].alt;
        if(plmcur > dirline) {
            gob("dirplm5").value = placemarks[plmcur].name;
            gob("dirplm6").value = placemarks[plmcur].desc;
        }
        gob("dirdoc1").value = docuname;
        gob("dirdoc2").value = docudesc;
        if(plmcur == dirline) {
            gob("dirplm5").disabled = true;
            gob("dirplm6").disabled = true;
        }
        showthis('dirtoppers');
        savedocudetails();
    }else{
        gob("plm1").value = placemarks[plmcur].name;
        gob("plm2").value = placemarks[plmcur].desc;
        gob("plm3").value = placemarks[plmcur].tess;
        gob("plm4").value = placemarks[plmcur].alt;
        gob("doc1").value = docuname;
        gob("doc2").value = docudesc;
        showthis('toppers');
    }
}
function savedocudetails(){
    if(directionsYes == 1) {
        placemarks[dirline].name = gob("dirplm1").value;
        placemarks[dirline].desc = gob("dirplm2").value;
        placemarks[dirline].tess = gob("dirplm3").value;
        placemarks[dirline].alt = gob("dirplm4").value;
        if(plmcur > dirline) {
            gob("dirplm5").disabled = false;
            gob("dirplm6").disabled = false;
            placemarks[plmcur].name = gob("dirplm5").value;
            placemarks[plmcur].desc = gob("dirplm6").value;
            markerShape.setTitle(placemarks[plmcur].name+"\n"+placemarks[plmcur].desc);
        }
        docuname = gob("dirdoc1").value;
        docudesc = gob("dirdoc2").value;
        logCode1a();
    }else{
        docuname = gob("doc1").value;
        docudesc = gob("doc2").value;
        placemarks[plmcur].name = gob("plm1").value;
        placemarks[plmcur].desc = gob("plm2").value;
        placemarks[plmcur].tess = gob("plm3").value;
        placemarks[plmcur].alt = gob("plm4").value;
        if(placemarks[plmcur].poly == "pl") logCode1();
        if(placemarks[plmcur].poly == "pg") logCode2();
    }
}
function mapzoom(){
    var mapZoom = map.getZoom();
    gob("myzoom").value = mapZoom;
}
function mapcenter(){
    var mapCenter = map.getCenter();
    var latLngStr = mapCenter.lat().toFixed(6) + ', ' + mapCenter.lng().toFixed(6);
    gob("centerofmap").value = latLngStr;
}
function showCodeintextarea(){
    if (notext === false){
        gob("presentcode").checked = false;
        notext = true;
    }else{
        gob("presentcode").checked = true;
        notext = false;
        if(polyPoints.length > 0){
            if(toolID==1) { // Polyline
                if(codeID==1) logCode1();
                if(codeID==2) logCode4();
            }
            if(toolID==2) { // Polygon
                if(adder!==0) { // with hole
                    adder = 0;
                    if(codeID == 1) logCode3();
                    if(codeID == 2) logCode5();
                }else{
                    if(codeID==1) logCode2();
                    if(codeID==2) logCode4();
                }
            }
            if(toolID==3) { // Rectangle
                if(codeID == 2) logCode6();
                if(codeID == 1) logCode2();
            }
            if(toolID==5) {  // Marker
                if(codeID == 1) logCode9();
            }
            if(toolID==6) { // Directions
                if(codeID == 1) logCode1a();
            }
        }
        if(toolID==4) { // Circle
            if(codeID == 2) logCode7();
        }
    }
}
// the copy part may not work with all web browsers
function copyTextarea(){
    gob('coords1').focus();
    gob('coords1').select();
    copiedTxt = document.selection.createRange();
    copiedTxt.execCommand("Copy");
}
function color_html2kml(color){
    var newcolor ="FFFFFF";
    if(color.length == 7) newcolor = color.substring(5,7)+color.substring(3,5)+color.substring(1,3);
    return newcolor;
}
function color_hex2dec(color) {
    var deccolor = "255,0,0";
    var dec1 = parseInt(color.substring(1,3),16);
    var dec2 = parseInt(color.substring(3,5),16);
    var dec3 = parseInt(color.substring(5,7),16);
    if(color.length == 7) deccolor = dec1+','+dec2+','+dec3;
    return deccolor;
}
function getopacityhex(opa){
    var hexopa = "66";
    if(opa == 0) hexopa = "00";
    if(opa == .0) hexopa = "00";
    if(opa >= .1) hexopa = "1A";
    if(opa >= .2) hexopa = "33";
    if(opa >= .3) hexopa = "4D";
    if(opa >= .4) hexopa = "66";
    if(opa >= .5) hexopa = "80";
    if(opa >= .6) hexopa = "9A";
    if(opa >= .7) hexopa = "B3";
    if(opa >= .8) hexopa = "CD";
    if(opa >= .9) hexopa = "E6";
    if(opa == 1.0) hexopa = "FF";
    if(opa == 1) hexopa = "FF";
    return hexopa;
}
function iconoptions(chosenicon) {
    gob("st2").value = chosenicon;
    gob("currenticon").innerHTML = '<img src="'+chosenicon+'" alt="" />';
}
// Called from button 'Style Options'
function styleprep() {
    if(gob('toolchoice').value == 6) toolID = 6;
    styleoptions();
}
// Called from styleprep, stepstyles and links in div directionstyles
// If coming from directionstyles, toolID=6 has been changed to 1 or 5
function styleoptions(){ //present current style in ..options
    closethis('polylineoptions');
    closethis('polygonoptions');
    //closethis('rectang');
    closethis('circleoptions');
    closethis('markeroptions');
    closethis('directionstyles');
    if(toolID == 1){
        showthis('polylineoptions'); // Edit style or create new style if sent to polylinestyle()
        //if(plmcur<placemarks.length-1) lcur = placemarks[plmcur].stylecur;
        gob('polylineinput1').value = polylinestyles[lcur].color;
        gob('polylineinput2').value = polylinestyles[lcur].lineopac;
        gob('polylineinput3').value = polylinestyles[lcur].width;
        gob('polylineinput4').value = polylinestyles[lcur].name;
        gob("stylenumberl").innerHTML = (lcur+1)+' ';
    }
    if(toolID == 2 || toolID == 3){
        showthis('polygonoptions');
        //if(plmcur<placemarks.length-1) pcur = placemarks[plmcur].stylecur;
        gob('polygoninput1').value = polygonstyles[pcur].color;
        gob('polygoninput2').value = polygonstyles[pcur].lineopac;
        gob('polygoninput3').value = polygonstyles[pcur].width;
        gob('polygoninput4').value = polygonstyles[pcur].fill;
        gob('polygoninput5').value = polygonstyles[pcur].fillopac;
        gob('polygoninput6').value = polygonstyles[pcur].name;
        gob("stylenumberp").innerHTML = (pcur+1)+' ';
    }
    if(toolID == 4) {
        showthis('circleoptions');
        gob('circinput1').value = circlestyles[ccur].color;
        gob('circinput2').value = circlestyles[ccur].lineopac;
        gob('circinput3').value = circlestyles[ccur].width;
        gob('circinput4').value = circlestyles[ccur].fill;
        gob('circinput5').value = circlestyles[ccur].fillopac;
        gob('circinput6').value = circlestyles[ccur].name;
        gob("stylenumberc").innerHTML = (ccur+1)+' ';
    }
    if(toolID == 5){
        showthis('markeroptions');
        gob('st1').value = markerstyles[mcur].name;
        iconoptions(markerstyles[mcur].icon);
        gob("stylenumberm").innerHTML = (mcur+1)+' ';
    }
    if(toolID == 6){
        showthis('directionstyles');
    }
}
// Called from links in polylineoptions. If Directionsmode, toolID will be changed back to 6
function polylinestyle(e){ //save style
    if(e == 1) {
        createlinestyleobject();
        lcur++;
    }
    polylinestyles[lcur].name = gob('polylineinput4').value;
    if(e == 1) {
        if(polylinestyles[lcur].name == polylinestyles[lcur-1].name) {
            lcur--;
            polylinestyles.pop();
            alert("Give the new style a new name");
            return;
        }
    }
    polylinestyles[lcur].color = gob('polylineinput1').value;
    polylineDecColorCur = color_hex2dec(polylinestyles[lcur].color);
    polylinestyles[lcur].lineopac = gob('polylineinput2').value;
    if(polylinestyles[lcur].lineopac<0 || polylinestyles[lcur].lineopac>1) return alert('Opacity must be between 0 and 1');
    polylinestyles[lcur].width = gob('polylineinput3').value;
    if(polylinestyles[lcur].width<0 || polylinestyles[lcur].width>20) return alert('Numbers below zero and above 20 are not accepted');
    polylinestyles[lcur].kmlcolor = getopacityhex(polylinestyles[lcur].lineopac) + color_html2kml(""+polylinestyles[lcur].color);
    if(directionsYes == 1) {
        placemarks[dirline].style = polylinestyles[lcur].name;
        placemarks[dirline].stylecur = lcur;
    }else{
        placemarks[plmcur].style = polylinestyles[lcur].name;
        placemarks[plmcur].stylecur = lcur;
    }
    gob("stylenumberl").innerHTML = (lcur+1)+' ';
    if(polyShape) polyShape.setMap(null);
    preparePolyline();
    if(directionsYes == 1) {
        toolID = 6;
    }
    if(polyPoints.length > 0) {
        if(toolID == 6) {
            logCode1a();
        }else{
            if(codeID == 1) logCode1();
            if(codeID == 2) logCode4();
        }
    }else{
        alert("SAVED!");
    }
}
function polygonstyle(e) {
    if(e == 1) {
        createpolygonstyleobject();
        pcur++;
    }
    polygonstyles[pcur].name = gob('polygoninput6').value;
    if(e == 1) {
        if(polygonstyles[pcur].name == polygonstyles[pcur-1].name) {
            pcur--;
            polygonstyles.pop();
            alert("Give the new style a new name");
            return;
        }
    }
    polygonstyles[pcur].color = gob('polygoninput1').value;
    polygonDecColorCur = color_hex2dec(polygonstyles[pcur].color);
    polygonstyles[pcur].lineopac = gob('polygoninput2').value;
    if(polygonstyles[pcur].lineopac<0 || polygonstyles[pcur].lineopac>1) return alert('Opacity must be between 0 and 1');
    polygonstyles[pcur].width = gob('polygoninput3').value;
    if(polygonstyles[pcur].width<0 || polygonstyles[pcur].width>20) return alert('Numbers below zero and above 20 are not accepted');
    polygonstyles[pcur].fill = gob('polygoninput4').value;
    polygonFillDecColorCur = color_hex2dec(polygonstyles[pcur].fill);
    polygonstyles[pcur].fillopac = gob('polygoninput5').value;
    if(polygonstyles[pcur].fillopac<0 || polygonstyles[pcur].fillopac>1) return alert('Opacity must be between 0 and 1');
    polygonstyles[pcur].kmlcolor = getopacityhex(polygonstyles[pcur].lineopac) + color_html2kml(""+polygonstyles[pcur].color);
    polygonstyles[pcur].kmlfill = getopacityhex(polygonstyles[pcur].fillopac) + color_html2kml(""+polygonstyles[pcur].fill);
    placemarks[plmcur].style = polygonstyles[pcur].name;
    placemarks[plmcur].stylecur = pcur;
    gob("stylenumberp").innerHTML = (pcur+1)+' ';
    if(polyShape) polyShape.setMap(null);
    if(outerShape) outerShape.setMap(null);
    if(holePolyArray.length > 0) {
        drawpolywithhole();
        if(codeID == 1) logCode3();
        if(codeID == 2) logCode5();
    }
    if(holePolyArray.length == 0) {
        preparePolygon();
        if(polyPoints.length > 0) {
            if(codeID == 1) logCode2();
            if(codeID == 2) logCode4();
        }else{
            alert("SAVED!");
        }
    }
}

function circlestyle(e) {
    if(e == 1) {
        createcirclestyleobject();
        ccur++;
    }
    circlestyles[ccur].name = gob('circinput6').value;
    if(e == 1) {
        if(circlestyles[ccur].name == circlestyles[ccur-1].name) {
            ccur--;
            circlestyles.pop();
            alert("Give the new style a new name");
            return;
        }
    }
    circlestyles[ccur].color = gob('circinput1').value;
    circlestyles[ccur].lineopac = gob('circinput2').value;
    if(circlestyles[ccur].lineopac<0 || circlestyles[ccur].lineopac>1) return alert('Opacity must be between 0 and 1');
    circlestyles[ccur].width = gob('circinput3').value;
    circlestyles[ccur].fill = gob('circinput4').value;
    circlestyles[ccur].fillopac = gob('circinput5').value;
    if(circlestyles[ccur].fillopac<0 || circlestyles[ccur].fillopac>1) return alert('Opacity must be between 0 and 1');
    placemarks[plmcur].style = circlestyles[ccur].name;
    placemarks[plmcur].stylecur = ccur;
    gob("stylenumberc").innerHTML = (ccur+1)+' ';
    if(circle) circle.setMap(null);
    activateCircle();
    if(radiusPoint) {
        drawCircle();
        logCode7();
    }else{
        alert("SAVED!");
    }
}
function markerstyle(e) {
    if(e == 1) {
        createmarkerstyleobject();
        mcur++;
    }
    markerstyles[mcur].name = gob('st1').value;
    if(e == 1) {
        if(markerstyles[mcur].name == markerstyles[mcur-1].name) {
            mcur--;
            markerstyles.pop();
            alert("Give the new style a new name");
            return;
        }
    }
    markerstyles[mcur].icon = gob('st2').value;
    placemarks[plmcur].style = markerstyles[mcur].name;
    placemarks[plmcur].stylecur = mcur;
    gob("stylenumberm").innerHTML = (mcur+1)+' ';
    if(directionsYes == 1) toolID = 6;
    if(markerShape) {
        markerShape.setIcon(markerstyles[mcur].icon);
        if(toolID == 6) {
            logCode1a();
        }else{
            if(codeID == 1) logCode9();
            if(codeID == 2) logCode8();
        }
        alert("SAVED!");
    }
}
function stepstyles(a) {
    if(directionsYes == 1) {
        if(gob('polylineoptions').style.visibility == 'visible') {
            toolID = 1;
        }else{
            toolID = 5;
        }
    }
    if(toolID == 1) {
        if(a == -1) {
            if (lcur > 0) {
                lcur--;
                gob("stylenumberl").innerHTML = (lcur+1)+' ';
                styleoptions();
            }
        }
        if(a == 1){
            if (lcur < polylinestyles.length - 1) {
                lcur++;
                gob("stylenumberl").innerHTML = (lcur+1)+' ';
                styleoptions();
            }
        }
        if(directionsYes == 1) {
            placemarks[dirline].style = polylinestyles[lcur].name;
            placemarks[dirline].stylecur = lcur;
        }else{
            placemarks[plmcur].style = polylinestyles[lcur].name;
            placemarks[plmcur].stylecur = lcur;
        }
        if(polyShape) polyShape.setMap(null);
        preparePolyline();
        if(directionsYes == 1) {
            toolID = 6;
        }
        if(polyPoints.length > 0) {
            if(toolID == 6) {
                logCode1a();
            }else{
                if(codeID == 1) logCode1();
                if(codeID == 2) logCode4();
            }
        }
    }
    if(toolID == 2 || toolID == 3) {
        if(a == -1) {
            if (pcur > 0) {
                pcur--;
                gob("stylenumberp").innerHTML = (pcur+1)+' ';
                styleoptions();
            }
        }
        if(a == 1){
            if (pcur < polygonstyles.length - 1) {
                pcur++;
                gob("stylenumberp").innerHTML = (pcur+1)+' ';
                styleoptions();
            }
        }
        placemarks[plmcur].style = polygonstyles[pcur].name;
        placemarks[plmcur].stylecur = pcur;
        if(polyShape) {
            //alert("polyShape");
            polyShape.setMap(null);
            preparePolygon();
            if(polyPoints.length) {
                if(codeID == 1) logCode2();
                if(codeID == 2) logCode4();
            }
        }
        /*if(rectangle) {
            //alert("polyShape");
            rectangle.setMap(null);
            activateRectangle();
            if(polyPoints.length) {
                if(codeID == 1) logCode2();
                if(codeID == 2) logCode4();
            }
        }*/
    }
    if(toolID == 4) {
        if(a == -1) {
            if (ccur > 0) {
                ccur--;
                gob("stylenumberc").innerHTML = (ccur+1)+' ';
                styleoptions();
            }
        }
        if(a == 1){
            if (ccur < circlestyles.length - 1) {
                ccur++;
                gob("stylenumberc").innerHTML = (ccur+1)+' ';
                styleoptions();
            }
        }
        placemarks[plmcur].style = circlestyles[ccur].name;
        placemarks[plmcur].stylecur = ccur;
        if(circle) circle.setMap(null);
        activateCircle();
        if(radiusPoint) {
            logCode7();
        }
    }
    if(toolID == 5) {
        if(a == -1) {
            if (mcur > 0) {
                mcur--;
                gob("stylenumberm").innerHTML = (mcur+1)+' ';
                styleoptions();
            }
        }
        if(a == 1){
            if (mcur < markerstyles.length - 1) {
                mcur++;
                gob("stylenumberm").innerHTML = (mcur+1)+' ';
                styleoptions();
            }
        }
        placemarks[plmcur].style = markerstyles[mcur].name;
        placemarks[plmcur].stylecur = mcur;
        if(directionsYes == 1) toolID = 6;
        if(markerShape) {
            markerShape.setIcon(markerstyles[mcur].icon);
            if(toolID == 6) {
                logCode1a();
            }else{
                if(codeID == 1) logCode9();
                if(codeID == 2) logCode8();
            }
        }
    }
}
function kmlheading() {
    var heading = "";
    var styleforpolygon = "";
    var styleforrectangle = "";
    var styleforpolyline = "";
    var styleformarker = "";
    var i;
    heading = '<?xml version="1.0" encoding="UTF-8"?>\n' +
        '<kml xmlns="http://www.opengis.net/kml/2.2">\n' +
        '<Document><name>'+docuname+'</name>\n' +
        '<description>'+docudesc+'</description>\n';
    for(i=0;i<polygonstyles.length;i++) {
        styleforpolygon += '<Style id="'+polygonstyles[i].name+'">\n' +
        '<LineStyle><color>'+polygonstyles[i].kmlcolor+'</color><width>'+polygonstyles[i].width+'</width></LineStyle>\n' +
        '<PolyStyle><color>'+polygonstyles[i].kmlfill+'</color></PolyStyle>\n' +
        '</Style>\n';
    }
    for(i=0;i<polylinestyles.length;i++) {
        styleforpolyline += '<Style id="'+polylinestyles[i].name+'">\n' +
        '<LineStyle><color>'+polylinestyles[i].kmlcolor+'</color><width>'+polylinestyles[i].width+'</width></LineStyle>\n' +
        '</Style>\n';
    }
    for(i=0;i<markerstyles.length;i++) {
        styleformarker += '<Style id="'+markerstyles[i].name+'">\n' +
        '<IconStyle><Icon><href>\n'+markerstyles[i].icon+'\n</href></Icon></IconStyle>\n' +
        '</Style>\n';
    }
    return heading+styleforpolygon+styleforpolyline+styleformarker;
}
function kmlend() {
    var ending;
    return ending = '</Document>\n</kml>';
}
// write kml for polyline in text area
function logCode1(){
    if (notext === true) return;
    var code = ""; // placemarks[plmcur].style = polylinestyles[lcur].name
    var kmltext1 = '<Placemark><name>'+placemarks[plmcur].name+'</name>\n' +
                    '<description>'+placemarks[plmcur].desc+'</description>\n' +
                    '<styleUrl>#'+placemarks[plmcur].style+'</styleUrl>\n' +
                    '<LineString>\n<tessellate>'+placemarks[plmcur].tess+'</tessellate>\n' +
                    '<altitudeMode>'+placemarks[plmcur].alt+'</altitudeMode>\n<coordinates>\n';
    for(var i = 0; i < pointsArrayKml.length; i++) {
        code += pointsArrayKml[i] + ',0\n';
    }
    kmltext2 = '</coordinates>\n</LineString>\n</Placemark>\n';
    placemarks[plmcur].plmtext = kmlcode = kmltext1+code+kmltext2;
    placemarks[plmcur].poly = "pl";
    placemarks[plmcur].jscode = pointsArray;
    placemarks[plmcur].kmlcode = pointsArrayKml;
    gob('coords1').value = kmlheading()+kmltext1+code+kmltext2+kmlend();
}
// write kml for Directions in text area
function logCode1a(){
    if (notext === true) return;
    gob('coords1').value = "";
    var code = "";
    //var kmlMarker = "";
    //var kmlMarkers = "";
    var kmltext1 = '<Placemark><name>'+placemarks[dirline].name+'</name>\n' +
                    '<description>'+placemarks[dirline].desc+'</description>\n' +
                    '<styleUrl>#'+placemarks[dirline].style+'</styleUrl>\n' +
                    '<LineString>\n<tessellate>'+placemarks[dirline].tess+'</tessellate>\n' +
                    '<altitudeMode>'+placemarks[dirline].alt+'</altitudeMode>\n<coordinates>\n';
    if(pointsArrayKml.length != 0) {
        for(var i = 0; i < pointsArrayKml.length; i++) {
            code += pointsArrayKml[i] + ',0\n';
        }
        placemarks[dirline].jscode = pointsArray;
        placemarks[dirline].kmlcode = pointsArrayKml;
    }
    kmltext2 = '</coordinates>\n</LineString>\n</Placemark>\n';
    placemarks[dirline].plmtext = kmltext1+code+kmltext2;
    placemarks[dirline].poly = "pl";
    gob('coords1').value = kmlheading()+kmltext1+code+kmltext2;
    if(markersArrayKml.length != 0) {
        for(i = 0; i < markersArrayKml.length; i++) {
            var kmlMarker = "";
            var m = dirline + 1;
            kmlMarker += '<Placemark><name>'+placemarks[m+i].name+'</name>\n' +
                            '<description>'+addresssArray[i]+'</description>\n' +
                            '<styleUrl>#'+placemarks[m+i].style+'</styleUrl>\n' +
                            '<Point>\n<coordinates>';
            kmlMarker += markersArrayKml[i] + ',0';
            kmlMarker += '</coordinates>\n</Point>\n</Placemark>\n';
            placemarks[m+i].jscode = markersArray[i];
            placemarks[m+i].kmlcode = markersArrayKml[i];
            placemarks[m+i].plmtext = kmlMarker;
            gob('coords1').value += kmlMarker;
        }
    }
    //placemarks[dirline].plmtext = kmlcode = kmltext1+code+kmltext2+kmlMarkers;
    gob('coords1').value += kmlend();
}
// write kml for polygon in text area
function logCode2(){
    if (notext === true) return;
    var code = "";
    var kmltext1 = '<Placemark><name>'+placemarks[plmcur].name+'</name>\n' +
                    '<description>'+placemarks[plmcur].desc+'</description>\n' +
                    '<styleUrl>#'+placemarks[plmcur].style+'</styleUrl>\n' +
                    '<Polygon>\n<tessellate>'+placemarks[plmcur].tess+'</tessellate>\n' +
                    '<altitudeMode>'+placemarks[plmcur].alt+'</altitudeMode>\n' +
                    '<outerBoundaryIs><LinearRing><coordinates>\n';
    if(pointsArrayKml.length != 0) {
        for(var i = 0; i < pointsArrayKml.length; i++) {
            code += pointsArrayKml[i] + ',0\n';
        }
        code += pointsArrayKml[0] + ',0\n';
        placemarks[plmcur].jscode = pointsArray;
        placemarks[plmcur].kmlcode = pointsArrayKml;
    }
    kmltext2 = '</coordinates></LinearRing></outerBoundaryIs>\n</Polygon>\n</Placemark>\n';
    placemarks[plmcur].plmtext = kmlcode = kmltext1+code+kmltext2;
    placemarks[plmcur].poly = "pg";
    gob('coords1').value = kmlheading()+kmltext1+code+kmltext2+kmlend();
}
// write kml for polygon with hole
function logCode3(){
    if (notext === true) return;
    var code = "";
    var kmltext = '<Placemark><name>'+placemarks[plmcur].name+'</name>\n' +
                    '<description>'+placemarks[plmcur].desc+'</description>\n' +
                    '<styleUrl>#'+placemarks[plmcur].style+'</styleUrl>\n' +
                    '<Polygon>\n<tessellate>'+placemarks[plmcur].tess+'</tessellate>\n' +
                    '<altitudeMode>'+placemarks[plmcur].alt+'</altitudeMode>\n' +
                    '<outerBoundaryIs><LinearRing><coordinates>\n';
    for(var i = 0; i < outerArrayKml.length; i++) {
        kmltext += outerArrayKml[i]+',0\n';
        code += outerArrayKml[i]+',0\n';
    }
    kmltext += outerArrayKml[0]+',0\n';
    code += outerArrayKml[0]+',0\n';
    placemarks[plmcur].jscode = pointsArray;
    placemarks[plmcur].kmlcode = outerArrayKml;
    placemarks[plmcur].kmlholecode = innerArraysKml;
    placemarks[plmcur].poly = "pgh";
    kmltext += '</coordinates></LinearRing></outerBoundaryIs>\n';
    for(var m = 0; m < innerArraysKml.length; m++) {
        kmltext += '<innerBoundaryIs><LinearRing><coordinates>\n';
        for(var i = 0; i < innerArraysKml[m].length; i++) {
            kmltext += innerArraysKml[m][i]+',0\n';
        }
        kmltext += innerArraysKml[m][0]+',0\n';
        kmltext += '</coordinates></LinearRing></innerBoundaryIs>\n';
    }
    kmltext += '</Polygon>\n</Placemark>\n';
    placemarks[plmcur].plmtext = kmlcode = kmltext;
    gob('coords1').value = kmlheading()+kmltext+kmlend();
}
// write javascript
function logCode4(){
    if (notext === true) return;
    gob('coords1').value = 'var myCoordinates = [\n';
    for(var i=0; i<pointsArray.length; i++){
        if(i == pointsArray.length-1){
            gob('coords1').value += 'new google.maps.LatLng('+pointsArray[i] + ')\n';
        }else{
            gob('coords1').value += 'new google.maps.LatLng('+pointsArray[i] + '),\n';
        }
    }
    if(toolID == 1){
        gob('coords1').value += '];\n';
        var options = 'var polyOptions = {\n'
        +'path: myCoordinates,\n'
        +'strokeColor: "'+polylinestyles[lcur].color+'",\n'
        +'strokeOpacity: '+polylinestyles[lcur].lineopac+',\n'
        +'strokeWeight: '+polylinestyles[lcur].width+'\n'
        +'}\n';
        gob('coords1').value += options;
        gob('coords1').value +='var it = new google.maps.Polyline(polyOptions);\n'
        +'it.setMap(map);\n';
        placemarks[plmcur].poly = "pl";
    }
    if(toolID == 2){
        gob('coords1').value += '];\n';
        var options = 'var polyOptions = {\n'
        +'path: myCoordinates,\n'
        +'strokeColor: "'+polygonstyles[pcur].color+'",\n'
        +'strokeOpacity: '+polygonstyles[pcur].lineopac+',\n'
        +'strokeWeight: '+polygonstyles[pcur].width+',\n'
        +'fillColor: "'+polygonstyles[pcur].fill+'",\n'
        +'fillOpacity: '+polygonstyles[pcur].fillopac+'\n'
        +'}\n';
        gob('coords1').value += options;
        gob('coords1').value +='var it = new google.maps.Polygon(polyOptions);\n'
        +'it.setMap(map);\n';
        placemarks[plmcur].poly = "pg";
    }
    javacode = gob('coords1').value;
}
// write javascript for polygon with hole
function logCode5() {
    if (notext === true) return;
    var hstring = "";
    gob('coords1').value = 'var outerPoints = [\n';
    for(var i=0; i<outerArray.length; i++){
        if(i == outerArray.length-1){
            gob('coords1').value += 'new google.maps.LatLng('+outerArray[i] + ')\n'; // without trailing comma
        }else{
            gob('coords1').value += 'new google.maps.LatLng('+outerArray[i] + '),\n';
        }
    }
    gob('coords1').value += '];\n';
    for(var m=0; m<innerArrays.length; m++){
        gob('coords1').value += 'var innerPoints'+m+' = [\n';
        var holestring = 'innerPoints'+m;
        if(m<innerArrays.length-1) holestring += ',';
        hstring += holestring;
        for(i=0; i<innerArrays[m].length; i++){
            if(i == innerArrays[m].length-1){
                gob('coords1').value += 'new google.maps.LatLng('+innerArrays[m][i] + ')\n';
            }else{
                gob('coords1').value += 'new google.maps.LatLng('+innerArrays[m][i] + '),\n';
            }
        }
        gob('coords1').value += '];\n';
    }
    gob('coords1').value += 'var myCoordinates = [outerPoints,'+hstring+'];\n';
    gob('coords1').value += 'var polyOptions = {\n'
    +'paths: myCoordinates,\n'
    +'strokeColor: "'+polygonstyles[pcur].color+'",\n'
    +'strokeOpacity: '+polygonstyles[pcur].lineopac+',\n'
    +'strokeWeight: '+polygonstyles[pcur].width+',\n'
    +'fillColor: "'+polygonstyles[pcur].fill+'",\n'
    +'fillOpacity: '+polygonstyles[pcur].fillopac+'\n'
    +'};\n'
    +'var it = new google.maps.Polygon(polyOptions);\n'
    +'it.setMap(map);\n';
    placemarks[plmcur].poly = "pgh";
    javacode = gob('coords1').value;
}
// write javascript or kml for rectangle
function logCode6() {
    if (notext === true) return;
    //placemarks[plmcur].style = polygonstyles[pcur].name;
    if(codeID == 2) { // javascript
        gob('coords1').value = 'var rectangle = new google.maps.Rectangle({\n'
            +'map: map,\n'
            +'fillColor: '+polygonstyles[pcur].fill+',\n'
            +'fillOpacity: '+polygonstyles[pcur].fillopac+',\n'
            +'strokeColor: '+polygonstyles[pcur].color+',\n'
            +'strokeOpacity: '+polygonstyles[pcur].lineopac+',\n'
            +'strokeWeight: '+polygonstyles[pcur].width+'\n'
            +'});\n';
        gob('coords1').value += 'var sWest = new google.maps.LatLng('+southWest.lat().toFixed(6)+','+southWest.lng().toFixed(6)+');\n'
        +'var nEast = new google.maps.LatLng('+northEast.lat().toFixed(6)+','+northEast.lng().toFixed(6)+');\n'
        +'var bounds = new google.maps.LatLngBounds(sWest,nEast);\n'
        +'rectangle.setBounds(bounds);\n';
        gob('coords1').value += '\n\\\\ Code for polyline rectangle\n';
        gob('coords1').value += 'var myCoordinates = [\n';
        gob('coords1').value += southWest.lat().toFixed(6) + ',' + southWest.lng().toFixed(6) + ',\n' +
                    southWest.lat().toFixed(6) + ',' + northEast.lng().toFixed(6) + ',\n' +
                    northEast.lat().toFixed(6) + ',' + northEast.lng().toFixed(6) + ',\n' +
                    northEast.lat().toFixed(6) + ',' + southWest.lng().toFixed(6) + ',\n' +
                    southWest.lat().toFixed(6) + ',' + southWest.lng().toFixed(6) + '\n';
        gob('coords1').value += '];\n';
        var options = 'var polyOptions = {\n'
        +'path: myCoordinates,\n'
        +'strokeColor: "'+polygonstyles[pcur].color+'",\n'
        +'strokeOpacity: '+polygonstyles[pcur].lineopac+',\n'
        +'strokeWeight: '+polygonstyles[pcur].width+'\n'
        +'}\n';
        gob('coords1').value += options;
        gob('coords1').value +='var it = new google.maps.Polyline(polyOptions);\n'
        +'it.setMap(map);\n';
        javacode = gob('coords1').value;
    }
    if(codeID == 1) { // kml
        var kmltext = '<Placemark><name>'+placemarks[plmcur].name+'</name>\n' +
                        '<description>'+placemarks[plmcur].desc+'</description>\n' +
                        '<styleUrl>#'+placemarks[plmcur].style+'</styleUrl>\n' +
                        '<Polygon>\n<tessellate>'+placemarks[plmcur].tess+'</tessellate>\n' +
                        '<altitudeMode>'+placemarks[plmcur].alt+'</altitudeMode>\n' +
                        '<outerBoundaryIs><LinearRing><coordinates>\n';
        kmltext += southWest.lng().toFixed(6) + ',' + southWest.lat().toFixed(6) + ',0\n' +
                    southWest.lng().toFixed(6) + ',' + northEast.lat().toFixed(6) + ',0\n' +
                    northEast.lng().toFixed(6) + ',' + northEast.lat().toFixed(6) + ',0\n' +
                    northEast.lng().toFixed(6) + ',' + southWest.lat().toFixed(6) + ',0\n' +
                    southWest.lng().toFixed(6) + ',' + southWest.lat().toFixed(6) + ',0\n';
        kmltext += '</coordinates></LinearRing></outerBoundaryIs>\n</Polygon>\n</Placemark>\n';
        placemarks[plmcur].plmtext = kmlcode = kmltext;
        gob('coords1').value = kmlheading()+kmltext+kmlend();
    }
}
function logCode7() { // javascript for circle
    if (notext === true) return;
    //placemarks[plmcur].style = circlestyles[ccur].name;
    gob('coords1').value = 'var circle = new google.maps.Circle({\n'
        +'map: map,\n'
        +'center: new google.maps.LatLng('+centerPoint.lat().toFixed(6)+','+centerPoint.lng().toFixed(6)+'),\n'
        +'fillColor: '+circlestyles[ccur].fill+',\n'
        +'fillOpacity: '+circlestyles[ccur].fillopac+',\n'
        +'strokeColor: '+circlestyles[ccur].color+',\n'
        +'strokeOpacity: '+circlestyles[ccur].lineopac+',\n'
        +'strokeWeight: '+circlestyles[ccur].width+'\n'
        +'});\n';
    gob('coords1').value += 'circle.setRadius('+calc+');\n';
    javacode = gob('coords1').value;
}
function logCode8(){ //javascript for Marker
	debugger;
	if(notext === true) return;
    var text = 'var image = \''+markerstyles[mcur].icon+'\';\n'
        +'var marker = new google.maps.Marker({\n'
        +'position: '+placemarks[plmcur].point+',\n'
        +'map: map, //global variable \'map\' from opening function\n'
        +'icon: image\n'
        +'});\n'
        +'//Your content for the infowindow\n'
        +'var html = \'<b>'+ placemarks[plmcur].name +'</b> <br/>'+ placemarks[plmcur].desc +'\';';
    gob('coords1').value = text;
    javacode = gob('coords1').value;
}
function logCode9() { //KML for marker
	debugger;
    if(notext === true) return;
    gob('coords1').value = "";
    var kmlMarkers = "";
    kmlMarkers += '<Placemark><name>'+placemarks[plmcur].name+'</name>\n' +
                    '<description>'+placemarks[plmcur].desc+'</description>\n' +
                    '<styleUrl>#'+placemarks[plmcur].style+'</styleUrl>\n' +
                    '<Point>\n<coordinates>';
    kmlMarkers += placemarks[plmcur].kmlcode + ',0';
    kmlMarkers += '</coordinates>\n</Point>\n</Placemark>\n';
    //placemarks[plmcur].poly = "pl";
    placemarks[plmcur].plmtext = kmlcode = kmlMarkers;
    gob('coords1').value = kmlheading()+kmlMarkers+kmlend();
}

function directionsintroduction() {
    gob('coords1').value = 'Ready for Directions. Create a route along roads with markers at chosen locations.\n'
            +'Click on the map, or enter an address and click "Search", to place a marker.\n'
            +'Lines will be drawn along roads from marker to marker.\n'
            +'Use "Delete Last Point" if you want to undo.\n'
            +'Styles and KML input may be managed before, during and after.\n'
            +'If after, click on the shape you want to edit.\n'
            +'Click "Next shape" before each edit.';
}
function markerintroduction() {
    gob('coords1').value = 'Ready for Marker. Click on the map, or enter an address and click "Search", to place a marker.\n'
            +'You may enter your content for the infowindow with "KML input" even if your code choice is Javascript.\n'
            +'Click "Next shape" before each additional marker.';
}
function polylineintroduction() {
    gob('coords1').value = 'Ready for Polyline. Click on the map. The code for the shape you create will be presented here.\n\n'
                        +'When finished with a shape, click Next shape and draw another shape, if you wish.\n'
                        +'\nIf you want to edit a saved polyline or polygon, click on it. Then click Edit lines. '
                        +'When editing, you may remove a point with a click on it.\n'
                        +'\nThe complete KML code for what you have created, is always available with Show KML.';
}
function polygonintroduction() {
    gob('coords1').value = 'Ready for Polygon. Click on the map. The code for the shape you create will be presented here. '
            +'The Maps API will automatically "close" any polygons by drawing a stroke connecting the last coordinate back to the '
            +'first coordinate for any given paths.\n'
            +'\nTo create a polygon with hole(-s), click "Hole" before you start the drawing.\n'
            +'\nWhen finished with a shape, click Next shape and draw another shape, if you wish.\n'
            +'\nIf you want to edit a saved polyline or polygon, click on it. Then click Edit lines. '
            +'When editing, you may remove a point with a click on it.\n'
            +'\nThe complete KML code for what you have created, is always available with Show KML.';
}
function rectangleintroduction() {
    gob('coords1').value = 'Ready for Rectangle. Click two times on the map - first for the southwest and '+
            'then for the northeast corner. You may resize and move '+
            'the rectangle with the two draggable markers you then have.\n\n'+
            'The v3 Rectangle is a polygon. But in Javascript code mode an extra code for '+
            'polyline is presented here in the text area.';
}
function circleintroduction() {
    gob('coords1').value = 'Ready for Circle. Click for center. Then click for radius distance. '+
    'You may resize and move the circle with the two draggable markers you then have.\n\n'+
    'KML code is not available for Circle.';
}
//]]>
</script>

<style type="text/css">
* {margin:0;padding:0;border:0;outline:0}

BODY {
    font-family: "Trebuchet MS", Arial,Helvetica,Sans Serif;
    font-size: 10pt;
}
a  {
	text-decoration : none;
}
a:hover  {
	text-decoration: underline;
}
p {
    padding-bottom: 8px;
}
#coords1 {
    padding: 5px;
    font-weight: bold;
}
#presenter {
    opacity:0.7;
    filter:alpha(opacity=70);
    -ms-filter:�alpha(opacity=70)�;
    -moz-opacity:0.7;
    KHTMLOpacity: 0.7;
    MozOpacity: 0.7;
    -khtml-opacity:.70;
}
#buttonrow {
    position: absolute;
    top: 800px;
    left: 600px;
    width: 505px;
    height: 80px;
}
#presenter {
    position: absolute;
    top: 800px;
    left: 50px;
    width: 523px;
    height: 413px;
    border: 2px solid #ccc;
}
#header {
    position: relative;
    top: -690px;
    left: 60px;
    width: 964px;
    height: 40px;
    background-color: #ffffff;
}
#map_canvas {
    position: relative;
    top: -710px;
    left: 57px;
    width: 950px;
    height: 650px;
    background-color: #ffffff;
}
#polygonstuff {
    position: absolute;
    top: 400px;
    left: 5px;
    width: 70px;
    height: 60px;
    background-color: #ff0000;
    color: #ffffff;
    visibility: hidden;
}
#title {
    background-color: transparent;
    width: 300px;
    float: left;
}
.choice {
    background-color: transparent;
    width: 100px;
    float: left;
}
h1 {
    font-size:25px;
    font-weight: bold;
    color: #ff0000;
    padding-top: 4px;
    padding-left: 10px;
    padding-bottom: 11px;
}
.topbutton {
    padding-top: 10px;
    padding-bottom: 10px;
    padding-left: 10px;
    float: left;
}
#googlead {
    margin: 0 auto;
    width: 800px;
    padding-top: 5px;
}
.clear {
	clear:both;
}
#content {
    margin: 10px
}
#polylineoptions {
    position: absolute;
    background-color: #ffffff;
    top: 200px;
    left: 560px;
    width: 260px;
    height: 210px;
    border: 2px solid #337EB7;
    visibility: hidden;
}
#polygonoptions {
    position: absolute;
    background-color: #ffffff;
    top: 200px;
    left: 560px;
    width: 260px;
    height: 255px;
    border: 2px solid #337EB7;
    visibility: hidden;
}
#rectang {
    position: absolute;
    background-color: #ffffff;
    top: 200px;
    left: 560px;
    width: 260px;
    height: 260px;
    border: 2px solid #337EB7;
    visibility: hidden;
}
#circleoptions {
    position: absolute;
    background-color: #ffffff;
    top: 200px;
    left: 560px;
    width: 260px;
    height: 260px;
    border: 2px solid #337EB7;
    visibility: hidden;
}
#markeroptions {
    width: 950px;
    height: 310px;
    background-color: #ffffff;
    margin: 2px 2px 2px 2px;
    padding: 8px;
    border: 1px solid #aaa;
    position: absolute;
    top: 45px;
    left: 10px;
    z-index:99999;
    visibility:hidden;
}
#directionstyles {
    position: absolute;
    background-color: #ffffff;
    top: 200px;
    left: 560px;
    width: 260px;
    height: 210px;
    border: 2px solid #337EB7;
    visibility: hidden;
}
#iconimages {
    width: 430px;
    height: 300px;
    background-color: #ffffff;
    margin: 2px 2px 2px 2px;
    padding: 8px;
    float: left;
}
#stylestext {
    width: 485px;
    height: 280px;
    background-color: #ffffff;
    margin: 0px 0px 2px 2px;
    padding: 5px;
    float: left;
}
#toppers {
    width: 405px;
    height: 300px;
    background-color: #ffffff;
    margin: 2px 2px 2px 2px;
    padding: 8px;
    position: absolute;
    top: 165px;
    left: 90px;
    z-index:99999;
    visibility:hidden;
}
#dirtoppers {
    width: 405px;
    height: 350px;
    background-color: #ffffff;
    margin: 2px 2px 2px 2px;
    padding: 8px;
    position: absolute;
    top: 165px;
    left: 90px;
    z-index:99999;
    visibility: hidden;
}
.styletitle {
    margin-left:5px;
    padding:0 3px 0 5px;
    font-weight:bold;
    background-color: #CCCCFF;
}
.closebutton {
    border:1px solid #000000;
    padding:1px 4px 1px 4px;
    margin:1px 3px 1px 0px;
    color:#ffffff;
    background-color: #337EB7;
}
#RegretButton {
    visibility: hidden;
}
.label {
	float: left;
	text-align: right;
	margin-right: 5px;
	width: 80px;
	padding-top: 5px;
}
.input {
    float: left;
	padding-left: 3px;
	width: 55px;
	margin: 3px 0px 0px 3px;
	border: 2px solid #ccc;
}
.inputlong {
    float: left;
	padding-left: 3px;
	width: 75px;
	margin: 3px 0px 0px 3px;
	border: 2px solid #ccc;
}
.oklink {
    margin-left: 25px;
    padding:0px 3px 0px 3px;
    background-color: #CCFF66;
    text-decoration: none;
}
#morelinks td {
    padding-right: 10px;
}
</style>
</head>

<body id="body" onload="initmap()">




<div class="mainRootDiv">
		<div class="mainHeaderDiv">
		<div class="ssLogo"><img src="images/SS_logo.png" alt="Security Sciences Logo" style="border-width: 0; height: 43px;"></div> 
		</div>


<div class="mainMenuDiv" {float: left; width: 50px; padding: 10px;>
			<div class="btnInformation btnMain"></div>
			<div class="btnAlerts btnMain"></div>
			<div class="btnMedicalTracker btnMain"></div>
			<div class="btnKidTracker btnMain"></div>
			<div class="btnCarTracker btnMain"></div>
			<div class="btnPetTracker btnMain"></div>
			<div class="btnHomeSecurity btnMain"></div>
			<div class="btnProperties btnMain"></div></div>
 

 
<div id="map_canvas"></div>
<div id="header">
    <div id="title">
        <h2> Recovery Tool</h2>
    </div>
    <div class="choice">
        <form id="tools" style="float:left;text-align:left;padding:10px 0px 0px 10px;" action="./" method="post" onsubmit="return false">
        <select id="toolchoice" name="toolchoice" style="border:1px solid #000000;" onchange="toolID=parseInt(this.options[this.selectedIndex].value);setTool();">
        <option selected="selected" value="1">Polyline</option>
        <option value="2">Polygon</option>
        <option value="3">Rectangle</option>
        <option value="4">Circle</option>
        <option value="5">Marker</option>
        <option value="6">Directions</option>
        </select>
        </form>
    </div>
    <div class="choice">
        <form id="codes" style="float:left;text-align:right;padding-top:10px;" action="./" method="post" onsubmit="return false">
        <select id="codechoice" name="codechoice" style="border:1px solid #000000;" onchange="codeID=parseInt(this.options[this.selectedIndex].value);setCode();">
        <option selected="selected" value="1">KML</option>
        <option value="2">Javascript</option>
        </select>
        </form>
    </div>
    <div id="middlerow">
        <form style="float:left;text-align:right;padding-top:10px;" action="#">
        <select id="over" style="width:150px; border:1px solid #000000;">
        <option>LngLat mousemove</option>
        <option selected="selected">LatLng mousemove</option>
        </select>
        <input type="button" onclick="mapcenter();" value="Mapcenter"/>
        <input type="text" style="width:100px; border: 1px solid #000000;" id="centerofmap" />
        Zoom level:
        <input type="text" size="5" name="myzoom" id="myzoom" value="7" style="width:15px; border: 1px solid #000000;" />
        </form>
    </div>
</div>


<div id="buttonrow">
	<div class="topbutton"><input type="button" onclick="nextshape();" value="Next shape"/></div>
	<div class="topbutton"><input type="button" onclick="clearMap();" value="Clear Map"/></div>
	<div class="topbutton"><input type="button" onclick="deleteLastPoint();" value="Delete Last Point"/></div>
	<div class="topbutton"><input type="button" onclick="styleprep();" value="Style Options"/></div>
	<div class="topbutton"><input type="button" onclick="editlines();" value="Edit lines" id="EditButton"/></div>
	<div class="topbutton"><input type="button" onclick='docudetails();' value="KML input"/></div>
	<div class="topbutton"><input type="button" onclick="showKML();" value="Show KML"/></div>
	<div class="topbutton"><input style="width:150px" type="button" onclick="copyTextarea();" value="Select and copy text"/></div>
	<div class="topbutton"><input type="button" onclick="regret();" value="Regret deleted point" id="RegretButton"/></div>


	<form style="margin-right:5px" action="#" onsubmit="showAddress(this.address.value); return false">
		<input type="text" style="border: 1px solid #000000;" size="50" name="address" value="Karl Johans gate 37, 1252 East 50 North, Lindon, UT" />
		<input type="submit" value="Search" />
	</form>
</div>
<div id="polygonstuff">
    <div>
        <a style="padding-left:5px; color: #ffffff;" href="javascript:holecreator()">Hole</a>
    </div>
    <div id="stepdiv" style="padding-left:5px">
        Step 0
    </div>
    <div>
        <input id="multipleholes" type="button" onclick="nexthole();" value="Next hole"/>
    </div>
</div>
<div id="presenter">
    <form style="margin-bottom:5px" action="#">
    &nbsp;&nbsp;&nbsp;Live code presentation in textarea (below):
    <input type="checkbox" name="showcodemode" id="presentcode" value="yes" onclick="showCodeintextarea();" checked="checked"/>
<textarea id="coords1" cols="62" rows="24">
Click on the map. The code for the shape you create will be presented here.
You may shift from Polyline to Polygon and vice/versa at any time when you draw.
When finished with a shape, click 'Next shape' and draw another shape, if you wish.
If you want to draw polygon with hole(-s), choose Polygon and follow the instructions.
Polyline and polygon may be edited by clicking 'Edit lines'.
When editing, you may remove a point with a click on it.
If you want to edit a saved polyline or polygon (including Rectangle), click on it. Then click 'Edit lines'.
There are style options for everything you draw on the map.
The complete KML code for what you have created, is always available with Show KML.
Uncheck 'Live code presentation' for greater speed when you draw shapes with large amount of points.
Check it when you want to see the code.
</textarea>
    </form>
</div>
<div id="polylineoptions">
    <div style="padding-top:5px; margin-bottom:10px;">
        <div style="float:left;" class="styletitle">POLYLINE</div>
        <div style="float:right;"><a class="closebutton" href="javascript:closethis('polylineoptions')">X</a></div>
    </div>
    <div class="clear"></div>
    <div style="float:left; padding-left:5px; width:230px">
        <form id="style1" style="padding-bottom:1px;" action="./" method="post" onsubmit="return false">
        <div class="label">strokeColor</div>
        <input class="input" type="text" name="color" id="polylineinput1" />
        <div class="clear"></div>
        <div class="label">strokeOpacity</div>
        <input class="input" type="text" name="opacity" id="polylineinput2" />
        <div class="clear"></div>
        <div class="label">strokeWeight</div>
        <input class="input" type="text" name="weight" id="polylineinput3" />
        <div class="clear"></div>
        <div class="label">Style id</div>
        <input class="inputlong" type="text" name="styleid" id="polylineinput4" />
        </form>
    </div>
    <div class="clear"></div>
    <div>
        <a class="oklink" href="javascript:polylinestyle(0)">Click here to save style changes</a>
    </div>
    <div style="margin-top:5px">
        <a class="oklink" href="javascript:polylinestyle(1)">Click here to save as new style</a>
    </div>
    <div style="width:100%; text-align:center; margin-top:5px">
        <input type="button" class="buttons" name="backwards" id="backwards" value="Previous" onclick="stepstyles(-1);"/>
         Style <span id="stylenumberl">1 </span>
        <input type="button" class="buttons" name="forwards" id="forwards" value="Next" onclick="stepstyles(1);"/>
    </div>
</div>
<div id="polygonoptions">
    <div style="padding-top:5px; margin-bottom:10px;">
        <div style="float:left;" class="styletitle">POLYGON/RECTANGLE</div>
        <div style="float:right;"><a class="closebutton" href="javascript:closethis('polygonoptions')">X</a></div>
    </div>
    <div class="clear"></div>
    <div style="float:left; padding-left:5px; width:230px">
        <form id="style2" style="padding-bottom:1px;" action="./" method="post" onsubmit="return false">
        <div class="label">strokeColor</div>
        <input class="input" type="text" name="color" id="polygoninput1" />
        <div class="clear"></div>
        <div class="label">strokeOpacity</div>
        <input class="input" type="text" name="opacity" id="polygoninput2" />
        <div class="clear"></div>
        <div class="label">strokeWeight</div>
        <input class="input" type="text" name="weight" id="polygoninput3" />
        <div class="clear"></div>
        <div class="label">fillColor</div>
        <input class="input" type="text" name="fillcolor" id="polygoninput4" />
        <div class="clear"></div>
        <div class="label">fillOpacity</div>
        <input class="input" type="text" name="fillopacity" id="polygoninput5" />
        <div class="clear"></div>
        <div class="label">Style id</div>
        <input class="inputlong" type="text" name="styleid" id="polygoninput6" />
        </form>
    </div>
    <div class="clear"></div>
    <div>
        <a class="oklink" href="javascript:polygonstyle(0)">Click here to save style changes</a>
    </div>
    <div style="margin-top:5px">
        <a class="oklink" href="javascript:polygonstyle(1)">Click here to save as new style</a>
    </div>
    <div style="width:100%; text-align:center; margin-top:5px">
        <input type="button" class="buttons" name="backwards" id="backwards" value="Previous" onclick="stepstyles(-1);"/>
         Style <span id="stylenumberp">1 </span>
        <input type="button" class="buttons" name="forwards" id="forwards" value="Next" onclick="stepstyles(1);"/>
    </div>
</div>

<div id="circleoptions">
    <div style="padding-top:5px; margin-bottom:10px;">
        <div style="float:left;" class="styletitle">CIRCLE</div>
        <div style="float:right;"><a class="closebutton" href="javascript:closethis('circleoptions')">X</a></div>
    </div>
    <div class="clear"></div>
    <div style="float:left; padding-left:5px; width:250px">
        <form id="rect" style="padding-bottom:1px;" action="./" method="post" onsubmit="return false">
        <div class="label">strokeColor</div>
        <input class="input" type="text" name="color" id="circinput1" />
        <div class="clear"></div>
        <div class="label">strokeOpacity</div>
        <input class="input" type="text" name="opacity" id="circinput2" />
        <div class="clear"></div>
        <div class="label">strokeWeight</div>
        <input class="input" type="text" name="weight" id="circinput3" />
        <div class="clear"></div>
        <div class="label">fillColor</div>
        <input class="input" type="text" name="fillcolor" id="circinput4" />
        <div class="clear"></div>
        <div class="label">fillOpacity</div>
        <input class="input" type="text" name="fillopacity" id="circinput5" />
        <div class="clear"></div>
        <div class="label">Style id</div>
        <input class="inputlong" type="text" name="styleid" id="circinput6" />
        </form>
    </div>
    <div class="clear"></div>
    <div>
        <a class="oklink" href="javascript:circlestyle(0)">Click here to save style changes</a>
    </div>
    <div style="margin-top:5px">
        <a class="oklink" href="javascript:circlestyle(1)">Click here to save as new style</a>
    </div>
    <div style="width:100%; text-align:center; margin-top:5px">
        <input type="button" class="buttons" name="backwards" id="backwards" value="Previous" onclick="stepstyles(-1);"/>
         Style <span id="stylenumberc">1 </span>
        <input type="button" class="buttons" name="forwards" id="forwards" value="Next" onclick="stepstyles(1);"/>
    </div>
</div>
<div id="markeroptions">
    <div id="iconimages">
    <table>
        <tr>
        <td><img src="http://maps.google.com/intl/en_us/mapfiles/ms/micons/red-dot.png" alt="" /></td>
        <td><img src="http://maps.google.com/intl/en_us/mapfiles/ms/micons/orange-dot.png" alt="" /></td>
        <td><img src="http://maps.google.com/intl/en_us/mapfiles/ms/micons/yellow-dot.png" alt="" /></td>
        <td><img src="http://maps.google.com/intl/en_us/mapfiles/ms/micons/green-dot.png" alt="" /></td>
        <td><img src="http://maps.google.com/intl/en_us/mapfiles/ms/micons/blue-dot.png" alt="" /></td>
        <td><img src="http://maps.google.com/intl/en_us/mapfiles/ms/micons/purple-dot.png" alt="" /></td>
        <td><img src="http://maps.google.com/intl/en_us/mapfiles/ms/micons/red.png" alt="" /></td>
        <td><img src="http://maps.google.com/intl/en_us/mapfiles/ms/micons/orange.png" alt="" /></td>
        <td><img src="http://maps.google.com/intl/en_us/mapfiles/ms/micons/yellow.png" alt="" /></td>
        <td><img src="http://maps.google.com/intl/en_us/mapfiles/ms/micons/green.png" alt="" /></td>
        <td><img src="http://maps.google.com/intl/en_us/mapfiles/ms/micons/blue.png" alt="" /></td>
        <td><img src="http://maps.google.com/intl/en_us/mapfiles/ms/micons/purple.png" alt="" /></td>
        </tr>
        <tr>
        <td><input type="button" name="button" value="Use" onclick='iconoptions("http://maps.google.com/intl/en_us/mapfiles/ms/micons/red-dot.png");' />
        </td>
        <td><input type="button" name="button" value="Use" onclick='iconoptions("http://maps.google.com/intl/en_us/mapfiles/ms/micons/orange-dot.png");' />
        </td>
        <td><input type="button" name="button" value="Use" onclick='iconoptions("http://maps.google.com/intl/en_us/mapfiles/ms/micons/yellow-dot.png");' />
        </td>
        <td><input type="button" name="button" value="Use" onclick='iconoptions("http://maps.google.com/intl/en_us/mapfiles/ms/micons/green-dot.png");' />
        </td>
        <td><input type="button" name="button" value="Use" onclick='iconoptions("http://maps.google.com/intl/en_us/mapfiles/ms/micons/blue-dot.png");' />
        </td>
        <td><input type="button" name="button" value="Use" onclick='iconoptions("http://maps.google.com/intl/en_us/mapfiles/ms/micons/purple-dot.png");' />
        </td>
        <td><input type="button" name="button" value="Use" onclick='iconoptions("http://maps.google.com/intl/en_us/mapfiles/ms/micons/red.png");' />
        </td>
        <td><input type="button" name="button" value="Use" onclick='iconoptions("http://maps.google.com/intl/en_us/mapfiles/ms/micons/orange.png");' />
        </td>
        <td><input type="button" name="button" value="Use" onclick='iconoptions("http://maps.google.com/intl/en_us/mapfiles/ms/micons/yellow.png");' />
        </td>
        <td><input type="button" name="button" value="Use" onclick='iconoptions("http://maps.google.com/intl/en_us/mapfiles/ms/micons/green.png");' />
        </td>
        <td><input type="button" name="button" value="Use" onclick='iconoptions("http://maps.google.com/intl/en_us/mapfiles/ms/micons/blue.png");' />
        </td>
        <td><input type="button" name="button" value="Use" onclick='iconoptions("http://maps.google.com/intl/en_us/mapfiles/ms/micons/purple.png");' />
        </td>
        </tr>
        <tr>
        <td><img src="http://maps.google.com/mapfiles/dd-start.png" alt="" /></td>
        <td><img src="http://maps.google.com/mapfiles/dd-end.png" alt="" /></td>
        <td><img src="http://maps.google.com/mapfiles/markerA.png" alt="" /></td>
        <td><img src="http://maps.google.com/mapfiles/marker_orangeA.png" alt="" /></td>
        <td><img src="http://maps.google.com/mapfiles/marker_yellowA.png" alt="" /></td>
        <td><img src="http://maps.google.com/mapfiles/marker_greenA.png" alt="" /></td>
        <td><img src="http://maps.google.com/mapfiles/marker_brownA.png" alt="" /></td>
        <td><img src="http://maps.google.com/mapfiles/marker_purpleA.png" alt="" /></td>
        <td><img src="http://maps.google.com/mapfiles/marker_blackA.png" alt="" /></td>
        <td><img src="http://maps.google.com/mapfiles/marker_greyA.png" alt="" /></td>
        <td><img src="http://maps.google.com/mapfiles/marker_whiteA.png" alt="" /></td>
        </tr>
        <tr>
        <td><input type="button" name="button" value="Use" onclick='iconoptions("http://maps.google.com/mapfiles/dd-start.png");' />
        </td>
        <td><input type="button" name="button" value="Use" onclick='iconoptions("http://maps.google.com/mapfiles/dd-end.png");' />
        </td>
        <td><input type="button" name="button" value="Use" onclick='iconoptions("http://maps.google.com/mapfiles/markerA.png");' />
        </td>
        <td><input type="button" name="button" value="Use" onclick='iconoptions("http://maps.google.com/mapfiles/marker_orangeA.png");' />
        </td>
        <td><input type="button" name="button" value="Use" onclick='iconoptions("http://maps.google.com/mapfiles/marker_yellowA.png");' />
        </td>
        <td><input type="button" name="button" value="Use" onclick='iconoptions("http://maps.google.com/mapfiles/marker_greenA.png");' />
        </td>
        <td><input type="button" name="button" value="Use" onclick='iconoptions("http://maps.google.com/mapfiles/marker_brownA.png");' />
        </td>
        <td><input type="button" name="button" value="Use" onclick='iconoptions("http://maps.google.com/mapfiles/marker_purpleA.png");' />
        </td>
        <td><input type="button" name="button" value="Use" onclick='iconoptions("http://maps.google.com/mapfiles/marker_blackA.png");' />
        </td>
        <td><input type="button" name="button" value="Use" onclick='iconoptions("http://maps.google.com/mapfiles/marker_greyA.png");' />
        </td>
        <td><input type="button" name="button" value="Use" onclick='iconoptions("http://maps.google.com/mapfiles/marker_whiteA.png");' />
        </td>
        </tr>
    </table>
    <table>
        <tr>
        <td><img src="icons/marker_20_red.png" alt="" /></td>
        <td><img src="icons/marker_20_orange.png" alt="" /></td>
        <td><img src="icons/marker_20_yellow.png" alt="" /></td>
        <td><img src="icons/marker_20_green.png" alt="" /></td>
        <td><img src="icons/marker_20_brown.png" alt="" /></td>
        <td><img src="icons/marker_20_blue.png" alt="" /></td>
        <td><img src="icons/marker_20_purple.png" alt="" /></td>
        <td><img src="icons/marker_20_black.png" alt="" /></td>
        <!--<td><img src="icons/marker_20_gray.png" alt="" /></td>-->
        <td><img src="icons/marker_20_white.png" alt="" /></td>
        </tr>
        <tr>
        <td><input type="button" name="button" value="Use" onclick='iconoptions("icons/marker_20_red.png");' />
        </td>
        <td><input type="button" name="button" value="Use" onclick='iconoptions("icons/marker_20_orange.png");' />
        </td>
        <td><input type="button" name="button" value="Use" onclick='iconoptions("icons/marker_20_yellow.png");' />
        </td>
        <td><input type="button" name="button" value="Use" onclick='iconoptions("icons/marker_20_green.png");' />
        </td>
        <td><input type="button" name="button" value="Use" onclick='iconoptions("icons/marker_20_brown.png");' />
        </td>
        <td><input type="button" name="button" value="Use" onclick='iconoptions("icons/marker_20_blue.png");' />
        </td>
        <td><input type="button" name="button" value="Use" onclick='iconoptions("icons/marker_20_purple.png");' />
        </td>
        <td><input type="button" name="button" value="Use" onclick='iconoptions("icons/marker_20_black.png");' />
        </td>
        <!--<td><input type="button" name="button" value="Use" onclick='iconoptions("icons/marker_20_gray.png");' />
        </td>-->
        <td><input type="button" name="button" value="Use" onclick='iconoptions("icons/marker_20_white.png");' />
        </td>
        </tr>
    </table>
    <table>
        <tr>
        <td><img src="http://maps.google.com/mapfiles/ms/micons/bar.png" alt="" /></td>
        <td><img src="http://maps.google.com/mapfiles/ms/micons/restaurant.png" alt="" /></td>
        <td><img src="http://maps.google.com/mapfiles/ms/micons/lodging.png" alt="" /></td>
        <td><img src="http://maps.google.com/mapfiles/ms/micons/golfer.png" alt="" /></td>
        <td><img src="http://maps.google.com/mapfiles/ms/micons/sportvenue.png" alt="" /></td>
        <td><img src="http://maps.google.com/mapfiles/ms/micons/plane.png" alt="" /></td>
        <td><img src="http://www.birdtheme.org/useful/images/square.png" alt="" /></td>
        </tr>
        <tr>
        <td>
        <input type="button" name="button" value="Use" onclick='iconoptions("http://maps.google.com/mapfiles/ms/micons/bar.png");' />
        </td>
        <td><input type="button" name="button" value="Use" onclick='iconoptions("http://maps.google.com/mapfiles/ms/micons/restaurant.png");' />
        </td>
        <td><input type="button" name="button" value="Use" onclick='iconoptions("http://maps.google.com/mapfiles/ms/micons/lodging.png");' />
        </td>
        <td><input type="button" name="button" value="Use" onclick='iconoptions("http://maps.google.com/mapfiles/ms/micons/golfer.png");' />
        </td>
        <td><input type="button" name="button" value="Use" onclick='iconoptions("http://maps.google.com/mapfiles/ms/micons/sportvenue.png");' />
        </td>
        <td><input type="button" name="button" value="Use" onclick='iconoptions("http://maps.google.com/mapfiles/ms/micons/plane.png");' />
        </td>
        <td><input type="button" name="button" value="Use" onclick='iconoptions("http://www.birdtheme.org/useful/images/square.png");' />
        </td>
        </tr>
    </table>
    </div>
    <div id="stylestext">
        <form action="#" style="padding-top:3px; margin-top:-5px">
            <div style="float:left;" class="styletitle">MARKER</div>
            <div style="float:right;"><a class="closebutton" href="javascript:closethis('markeroptions')">X</a></div>
            <div class="clear"></div>
            <div><br />
                &lt;Style id =<input type="text" id="st1" value="markerstyle" style="width:100px; border: 2px solid #ccc;" /><br />
                &nbsp;&nbsp;&lt;Icon&gt;&lt;href&gt;
                <input type="text" id="st2" value="http://maps.google.com/intl/en_us/mapfiles/ms/micons/red-dot.png" style="width:380px; border: 2px solid #ccc;" /><br />
                <span id="currenticon" style="height: 35px"><img src="http://maps.google.com/intl/en_us/mapfiles/ms/micons/red-dot.png" alt="" /></span>
                Use default icon, or choose icon from the chart
                <input style="width:120px; margin-left:8px" type="button" name="button" value="Back to default icon" onclick='iconoptions("http://maps.google.com/intl/en_us/mapfiles/ms/micons/red-dot.png");' />
                <br /><br />
            </div>
            <div style="margin-top:5px">
                <a class="oklink" href="javascript:markerstyle(0)">Click here to save style changes</a>
                <a class="oklink" href="javascript:markerstyle(1)">Click here to save as new style</a>
            </div>
            <div style="width:100%; text-align:center; margin-top:5px">
                <input type="button" class="buttons" name="backwards" value="Previous" onclick="stepstyles(-1);"/>
                 Style <span id="stylenumberm">1 </span>
                <input type="button" class="buttons" name="forwards" value="Next" onclick="stepstyles(1);"/>
            </div>
        </form>
    </div>
</div>
<div id="directionstyles">
    <div style="float:right;"><a class="closebutton" href="javascript:closethis('directionstyles')">X</a></div>
    <div class="clear"></div>
    <div style="width:100%; text-align:center; padding-top:40px">
    <input type="button" class="buttons" name="markerbutton" value="Markerstyles" onclick="toolID=5;styleoptions();"/>
    </div>
    <div style="width:100%; text-align:center; padding-top:15px">
    <input type="button" class="buttons" name="linebutton" value="Linestyles" onclick="toolID=1;styleoptions();"/>
    </div>
</div>
<div id="toppers">
    <form action="#">
    &lt;Document&gt;<br />
    &nbsp;&nbsp;&lt;name&gt;<input type="text" id="doc1" value="My document" style="width:345px; border:2px solid #ccc;" /><br />
    &nbsp;&nbsp;&lt;description&gt;<input type="text" id="doc2" value="Content" style="width:312px; border:2px solid #ccc;" /><br /><br />
    &lt;Placemark&gt;<br />
    &nbsp;&nbsp;&lt;name&gt;<input type="text" id="plm1" value="NAME" style="width:345px; border:2px solid #ccc;" /><br />
    &nbsp;&nbsp;&lt;description&gt;<input type="text" id="plm2" value="YES" style="width:312px; border:2px solid #ccc;" /><br />
    &nbsp;&nbsp;&lt;styleURL&gt;<em> current style</em><br />
    &nbsp;&nbsp;&lt;tessellate&gt;<input type="text" id="plm3" value="1" style="width:20px; border:2px solid #ccc;" />&lt;/tessellate&gt;
    &lt;altitudemode&gt;<input type="text" id="plm4" value="clampToGround" style="width:100px; border:2px solid #ccc;" /><br /><br />
    You may create or change styles with the "Style Options" button.<br />
    You may press it now or anytime.<br /><br />
    <input type="button" name="docu" id="docu" value="Save" onclick='savedocudetails();document.getElementById("toppers").style.visibility = "hidden";'/>
    <input type="button" value="Close" onclick='document.getElementById("toppers").value="";document.getElementById("toppers").style.visibility = "hidden";'/>
    </form>
</div>
<div id="dirtoppers">
    <form action="#">
    &lt;Document&gt;<br />
    &nbsp;&nbsp;&lt;name&gt;<input type="text" id="dirdoc1" value="My document" style="width:345px; border:2px solid #ccc;" /><br />
    &nbsp;&nbsp;&lt;description&gt;<input type="text" id="dirdoc2" value="Content" style="width:312px; border:2px solid #ccc;" /><br /><br />
    &lt;Placemark&gt;&nbsp;for line<br />
    &nbsp;&nbsp;&lt;name&gt;<input type="text" id="dirplm1" value="NAME" style="width:345px; border:2px solid #ccc;" /><br />
    &nbsp;&nbsp;&lt;description&gt;<input type="text" id="dirplm2" value="YES" style="width:312px; border:2px solid #ccc;" /><br />
    &nbsp;&nbsp;&lt;styleURL&gt;<em> current style</em><br />
    &nbsp;&nbsp;&lt;tessellate&gt;<input type="text" id="dirplm3" value="1" style="width:20px; border:2px solid #ccc;" />&lt;/tessellate&gt;
    &lt;altitudemode&gt;<input type="text" id="dirplm4" value="clampToGround" style="width:100px; border:2px solid #ccc;" /><br /><br />
    &lt;Placemark&gt;&nbsp;for marker<br />
    &nbsp;&nbsp;&lt;name&gt;<input type="text" id="dirplm5" value="NAME" style="width:345px; border:2px solid #ccc;" /><br />
    &nbsp;&nbsp;&lt;description&gt;<input type="text" id="dirplm6" value="YES" style="width:312px; border:2px solid #ccc;" /><br />
    &nbsp;&nbsp;&lt;styleURL&gt;<em> current style</em><br />
    You may create or change styles with the "Style Options" button.<br />
    You may press it now or anytime in Directions mode.<br /><br />
    <input type="button" name="docu" id="docu" value="Save" onclick='savedocudetails();document.getElementById("dirtoppers").style.visibility = "hidden";'/>
    <input type="button" value="Close" onclick='document.getElementById("dirtoppers").value="";document.getElementById("dirtoppers").style.visibility = "hidden";'/>
    </form>
</div>
<div class="clear"></div>
<div style="height:580px"></div>

<div id = "content">
<p>This application is also available with
<a href="http://www.birdtheme.org/useful/v3largemap.html">Large map.</a></p>
<p>
This is a drawing tool for polyline, polygon, polygon with holes, rectangle, circle, marker(icon), direction(route, path).
This application uses the Google Maps API Version 3 (V3). It has all the features of Google Maps MyMaps and
has direct access to the code for the shapes (overlays) you create. It should be a full-fledged alternative.
You draw and create a map with the shapes you want. KML or Javascript code is presented in the textarea.
You copy KML code and paste it into a text editor. Then you have a KML file you may upload to your website.
This application should now also serve as a mature alternative to my online V2 tool
<a href="http://www.birdtheme.org/useful/googletool.html">Digitizer tool</a>
</p>
<p>Code will be presented in the textarea. You may choose to see KML or Google Javascript V3.
</p>
<p>The OpenStreetMap map type has been added to the Google Maps map types. It has been
embedded as a layer within the Google Map. This will in many parts
of the world give you map tiles with more details than the default Google Maps tiles.
</p>
<p>
<script type="text/javascript">
ch_client = "webbirder";
ch_width = 550;
ch_height = 250;
ch_type = "mpu";
ch_sid = "Chitika Default";
ch_backfill = 1;
ch_color_site_link = "0000cc";
ch_color_title = "0000cc";
ch_color_border = "ffffff";
ch_color_text = "000000";
ch_color_bg = "ffffff";
</script>

</p>
<p>
The feature 'polygon with hole' ('donut') is built-in in V3. Choose Polygon draw mode and follow the instructions.
All overlays have style options. There are some custom markers (icons) available for Marker and Direction.
</p>
<p>
The V2 feature enableEditing now exists for V3. But it lacks 'Click to remove'. It is possible to build the feature for V3 with some javascript.<br />
I have posted an example here:
<a href="http://www.birdtheme.org/useful/editingv3.html">Enable editing in V3</a> And this method is used
here in this application to enable editing.
</p>
<p>And for editing - if you have a kml file uploaded on a server, and you want to edit its coordinates,
you may use my edit tool <a href="http://www.birdtheme.org/useful/editkmlfilev3.php">Edit tool for Google maps polyline and polygon</a><br />
You will need a PC or laptop with a large amount of computer memory if your kml file has 1000
coordinate pairs or more.</p>
<p>Load your kml file with the php function simplexml_load_file(kmlfile) if you want to handle
individual shapes in your kml file
<a href="http://www.birdtheme.org/useful/sub/kmlwithv3.php">Dynamic Google Maps API V3</a></p>
<p>If you are new to Google Maps, it may be useful to read the tutorial
<a href="http://code.google.com/intl/no/apis/maps/documentation/javascript/tutorial.html">Google Maps Javascript API V3 Tutorial</a>
and learn how to display the overlays you can create here on a map.
</p>
<p>If you need to learn how to use KML, this is where you start
<a href="http://code.google.com/intl/no/apis/kml/">KML</a></p>
Other useful links:<br />

<table id="morelinks">
<tr>
<td><a href="http://code.google.com/intl/no/apis/maps/documentation/v3/">Google Maps V3 Documentation</a></td>
<td rowspan="2">
<form action="https://www.paypal.com/cgi-bin/webscr" method="post">
<input type="hidden" name="cmd" value="_s-xclick">
<input type="hidden" name="hosted_button_id" value="DHMCKU8XE4HZE">
<input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donateCC_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
<img alt="" border="0" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1" height="1">
</form>
</td>
</tr>
<tr>
<td><a href="http://groups.google.com/group/google-maps-js-api-v3">Google Maps API V3 discussion group</a></td>
<td></td>
</tr>
</table>
</div>

Contact: maps@security-sciences.org



	

 <p><a href = "/index.htm"> After you make the template look good,  we have to make the Login page color compatible</a></p>
</body>
