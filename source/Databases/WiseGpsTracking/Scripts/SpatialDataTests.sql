USE WISE_GPSTRACKING
GO

BEGIN TRANSACTION

INSERT INTO dbo.MS_AccountGeoFences
        ( GeoFenceTypeId ,
          AccountId ,
          GeogCol1 
        )
VALUES  ( 'POLY' , -- GeoFenceTypeId - varchar(50)
          110 , -- AccountId - bigint
          GEOGRAPHY::STGeomFromText('POLYGON((-111.896009 40.768454, -111.896031 40.768324, -111.89485 40.766228, -111.893134 40.766017, -111.890902 40.766553, -111.889958 40.767772, -111.889829 40.769868, -111.893134 40.770323, -111.894657 40.770258, -111.896009 40.768454))', 4326)
        )
        
/** position: (40.76858449793401, -111.89272601852417) */
DECLARE @InsidePoint GEOGRAPHY;
SET @InsidePoint = GEOGRAPHY::STGeomFromText('POINT(-111.89272601852417 40.76858449793401)', 4326);
DECLARE @OutsidePoint GEOGRAPHY;
SET @OutsidePoint  = GEOGRAPHY::STGeomFromText('POINT(-111.900537 40.768414)', 4326);

SELECT GeogCol1.STIntersects(@InsidePoint) AS [Inside Point], GeogCol1.STIntersects(@OutsidePoint) AS [OutSide Point] FROM dbo.MS_AccountGeoFences WHERE GeoFenceID = 4

ROLLBACK TRANSACTION

SELECT * FROM dbo.MS_AccountGeoFences
--          GEOGRAPHY::STGeomFromText('POLYGON((-111.896009 40.768454,-111.894657 40.770258,-111.893134 40.770323,-111.889829 40.769868,-111.889958 40.767772,-111.890902 40.766553,-111.893134 40.766017,-111.894850 40.766228,-111.896031 40.768324))', 4326)
--          GEOGRAPHY::STGeomFromText('POINT(-111.896009 40.768454)', 4326)


DECLARE @g geography;
DECLARE @h geography;
SET @g = geography::STGeomFromText('POLYGON((-122.358 47.653, -122.348 47.649, -122.348 47.658, -122.358 47.658, -122.358 47.653))', 4326);
SET @h = geography::Point(47.653, -122.358, 4326)

SELECT @g.STIntersects(@h) AS Result


SELECT * FROM [WISE_GPSTRACKING].dbo.fn_ParseText2Table('-111.896009 40.768454, -111.896031 40.768324, -111.89485 40.766228, -111.893134 40.766017, -111.890902 40.766553, -111.889958 40.767772, -111.889829 40.769868, -111.893134 40.770323, -111.894657 40.770258, -111.896009 40.768454', ',');



DECLARE @col VARCHAR(MAX);
SET @col = '-111.896009 40.768454, -111.896031 40.768324, -111.89485 40.766228, -111.893134 40.766017, -111.890902 40.766553, -111.889958 40.767772, -111.889829 40.769868, -111.893134 40.770323, -111.894657 40.770258, -111.896009 40.768454';
EXECUTE dbo.custGS_AccountGeoFencePolygonSave 1, 'POLY', 100001, @col, 'ME';


SELECT * FROM [WISE_GPSTRACKING].dbo.fn_ParseGpsCoordinates('-111.896009 40.768454, -111.896031 40.768324, -111.89485 40.766228, -111.893134 40.766017, -111.890902 40.766553, -111.889958 40.767772, -111.889829 40.769868, -111.893134 40.770323, -111.894657 40.770258, -111.896009 40.768454', ',');
SELECT * FROM dbo.GS_AccountGeoFencePolygons 